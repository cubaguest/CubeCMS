<?
$this->addCssFile("style.css");

define('SECTION_EDTI_LABEL', $this->_('Upravit'));
define('SECTION_REMOVE_LABEL', $this->_('Smazat'));
define('SECTION_SETTINGS_LABEL', $this->_('Upravit parametry'));
define('SECTION_MOVEUP_LABEL', $this->_('Nahoru'));
define('SECTION_MOVEDOWN_LABEL', $this->_('Dolu'));

// funkce pro render menu
function vveSectionsRenderFunc($menuArr, $link) {
   $link2 = clone $link;
   $link3 = clone $link;
   //   print ("<ul>\n");
   $first = true;
   $count = $menuArr->count();
   $cycle = 0;
   //   $level = $menuArr->getLevel();
   foreach ($menuArr as $key => $item) {$cycle++?>
<tr><td>
      <span class="sec"><?=str_repeat('&nbsp;', ($item->getLevel())*6).$item?></span>
      <a href="<?=$link3->clear()->category($item->getCatObj()->getUrlKey())?>" title="<?=$item?>">link</a>
      ID:<?=$item->getId()?>
   </td><td width="110">
      <form method="post" action="<?=$link2->route('settings',array('categoryid' => $item->getId()))?>" style="display:inline;">
         <input type="image" src="<?=vve_get_tpl_file('icons/cog_edit.png', VVE_TPL_FILE_IMAGE)?>"
                value="edit" name="category_settings" title="<?=SECTION_SETTINGS_LABEL?>" />
      </form>
      <form method="post" action="<?=$link2->route('edit',array('categoryid' => $item->getId()))?>" style="display:inline;">
         <input type="image" src="<?=vve_get_tpl_file('icons/application_edit.png', VVE_TPL_FILE_IMAGE)?>"
                value="edit" name="category_edit" title="<?=SECTION_EDTI_LABEL?>" />
      </form>
      <form method="post" action="<?=$link?>" style="display:inline;" onsubmit="return submitRemoveCat('<?=$item;?>')">
         <input type="hidden" value="<?=$item->getId()?>" name="category_id" />
         <input type="image" src="<?=vve_get_tpl_file('icons/application_delete.png', VVE_TPL_FILE_IMAGE)?>"
                value="remove" name="category_remove" title="<?=SECTION_REMOVE_LABEL?>" />
      </form>
            <?if(!$first) {?>
      <form method="post" action="<?=$link?>" style="display:inline;">
         <input type="hidden" value="<?=$item->getId()?>" name="item_id" />
         <input type="hidden" value="up" name="item_move_to" />
         <input type="image" src="<?=vve_get_tpl_file('icons/go-up.png', VVE_TPL_FILE_IMAGE)?>"
                value="edit" name="item_move" title="<?=SECTION_MOVEUP_LABEL?>" />
      </form>
            <?}
            if($cycle < $count) {?>
      <form method="post" action="<?=$link?>" style="display:inline;">
         <input type="hidden" value="<?=$item->getId()?>" name="item_id" />
         <input type="hidden" value="down" name="item_move_to" />
         <input type="image" src="<?=vve_get_tpl_file('icons/go-down.png', VVE_TPL_FILE_IMAGE)?>"
                value="edit" name="item_move" title="<?=SECTION_MOVEDOWN_LABEL?>" />
      </form>
            <?}?>
   </td>
</tr>
<tr>
   <td colspan="2"><hr /></td>
</tr>
      <?
      if(!$item->isEmpty()) {
         vveSectionsRenderFunc($item, $link);
      }
      $first = false;
   }
//   print ("</ul>\n");
}
?>
<div>
   <?//sekce
   $typeClass = 'mainStruct';
   if($this->adminStructure == true) {$typeClass = 'adminStruct';}
   ?>
   <h2><?=$this->_("Struktura stránek")?></h2>
   <div id="sections" class="<?=$typeClass?>">
      <table style="width: 98%">
         <?=vveSectionsRenderFunc($this->structure, $this->link())?>
      </table>
   </div>
   <br />
   <?$this->includeTpl('structtype.phtml');?><br />
   <br />
   <script type="text/javascript">
      function submitRemoveCat(msg){
         return confirm('<?=$this->_('Opravdu smazat kategorii: ')?>'+msg+'?');
      }
   </script>

   <?
   if($this->category()->getRights()->isWritable()) {
      $toolbox = new Template_Toolbox();
      $toolbox->addTool('add_category', $this->_("Přidat kategorii"),
          $this->link()->route('add'),
          $this->_("Přidat novou kategorii"), "application_add.png");
      $this->includeTplObj($toolbox);
   }
   ?>
</div>

