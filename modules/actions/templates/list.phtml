<?
$this->addPageTitle(vve_date("%x", $this->dateFrom).' - '.vve_date("%x", $this->dateTo));
//$this->addPageHeadline(strftime("%x", $this->dateFrom).' - '.strftime("%x", $this->dateTo));

?>
<h1><?=$this->category->getName().' - '.vve_date("%x", $this->dateFrom).' - '.vve_date("%x", $this->dateTo)?></h1>
<div class="main-content-list">
   <?
   if($this->text != false) {?>
   <div class="main-content-text">
         <?=$this->text->{Text_Model_Detail::COLUMN_TEXT}?>
   </div>
      <?}?>

   <div class="main-content-tools">
      <a href="<?=$this->link()->route('archive')?>" title="<?=$this->_('Archiv')?>"><?=$this->_('Archiv')?></a>
   </div>

   <?while ($row = $this->actions->fetch()) {
      if($row->{Actions_Model_Detail::COLUMN_PUBLIC}) $class = "";
      else $class = 'main-content-no-public';
      $subLabel = $row->{Actions_Model_Detail::COLUMN_NAME};
      if($row->{Actions_Model_Detail::COLUMN_SUBANME} != null) {
         $subLabel = '<span class="">'.$row->{Actions_Model_Detail::COLUMN_SUBANME}.'</span><br />'.$subLabel;
      }

      ?>
   <div class="main-content-list-record <?=$class?>">
      <h2><a href="<?=$this->link()->route('detail', array('urlkey' => $row->{Actions_Model_Detail::COLUMN_URLKEY}))?>"
             title="<?=$row->{Actions_Model_Detail::COLUMN_NAME}?>"
             ><?=$subLabel?></a></h2>
            <?if($row->{Actions_Model_Detail::COLUMN_AUTHOR} != null) {?>
      <div class="main-content-text">
               <?=$row->{Actions_Model_Detail::COLUMN_AUTHOR}?>
      </div>
            <?}?>
      <div class="main-content-text">
            <?
            $startDate = vve_date("%x", new DateTime($row->{Actions_Model_Detail::COLUMN_DATE_START}));
            $stopDate = vve_date("%x", new DateTime($row->{Actions_Model_Detail::COLUMN_DATE_STOP}));
            print ($startDate);
            if($startDate != $stopDate AND $row->{Actions_Model_Detail::COLUMN_DATE_STOP} != null) {
               print ("&nbsp;&mdash;&nbsp;");
               print ($stopDate);
            }
            if($row->{Actions_Model_Detail::COLUMN_TIME} != null) {
               $time = new DateTime($row->{Actions_Model_Detail::COLUMN_TIME});
               print (",&nbsp;".$time->format("G:i"));
            }
            if($row->{Actions_Model_Detail::COLUMN_PLACE} != null) {
               print ',&nbsp;'.$row->{Actions_Model_Detail::COLUMN_PLACE};
            }
            if((int)$row->{Actions_Model_Detail::COLUMN_PRICE} != null|0) {
               printf(',&nbsp;'.strtolower($this->_('Vstupné: %d Kč')),$row->{Actions_Model_Detail::COLUMN_PRICE});
            }
            if((int)$row->{Actions_Model_Detail::COLUMN_PREPRICE} != null|0) {
               printf(',&nbsp;'.strtolower($this->_('V předprodeji: %d Kč')),$row->{Actions_Model_Detail::COLUMN_PREPRICE});
            }
            ?>
      </div>
         <?if($row->{Actions_Model_Detail::COLUMN_NOTE} != null) {?>
      <div class="main-content-text">
          <?=$row->{Actions_Model_Detail::COLUMN_NOTE}?>
      </div>
            <?}?>
      <?if($row->{Actions_Model_Detail::COLUMN_IMAGE} != null) {?>
         <div class="main-content-image">
         <?echo (vve_tpl_image_tag($this->category()->getModule()->getDataDir(true)
              .$row[Actions_Model_Detail::COLUMN_URLKEY][Locales::getDefaultLang()].DIRECTORY_SEPARATOR
              .$row->{Actions_Model_Detail::COLUMN_IMAGE}, 'image',
                 $this->category()->getParam('img_width',  Actions_Controller::MAIN_IMAGE_WIDTH),
                 $this->category()->getParam('img_height',Actions_Controller::MAIN_IMAGE_HEIGHT), 'actionImage'));?>
         </div>
      <?}?>
      <div class="main-content-text">
            <?=vve_tpl_xhtml_cut(strip_tags($row->{Actions_Model_Detail::COLUMN_TEXT},'<br><a><b><strong><em><i>'), 600);?>
      </div>
      <p class="main-content-link-more">
         <a href="<?=$this->link()->route('detail',
                       array('urlkey' => $row->{Actions_Model_Detail::COLUMN_URLKEY}))?>"
            title="<?=$this->_('Více')?>"><?=$this->_('Více')?></a>
      </p>
   </div>
      <?}?>
   &laquo;&nbsp;<a href="<?=$this->linkBack?>" title="<?=$this->linkBackLabel?>"
     ><?=$this->linkBackLabel?></a>&nbsp;&brvbar;&nbsp;<a
     href="<?=$this->linkNext?>" title="<?=$this->linkNextLabel?>"><?=$this->linkNextLabel?></a>&nbsp;&raquo;
   <br/>
   <br/>
   <?
   echo $this->feedsComp;
   if($this->category()->getRights()->isWritable()) {
      $toolbox = new Template_Toolbox();
      $toolbox->addTool('add_action', $this->_("Přidat akci"),
              $this->link()->route('add'),
              $this->_("Přidat novou akci"), "page_add.png");
      if($this->category()->getRights()->isControll()) {
         $toolbox->addTool('edit_action_text', $this->_("Upravit úvodní text"),
                 $this->link()->route('editlabel'),
                 $this->_("Upravit úvodní text"), "page_edit.png");
      }
      $this->includeTplObj($toolbox);
   }
   ?>
</div>