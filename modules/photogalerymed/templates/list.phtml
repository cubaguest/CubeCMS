<?
$this->addCssFile("style.css");
$this->includeTpl('sortLabel.phtml',false,null,'articles');
$h1 = $this->category()->getName().$this->sortText;
$modelImages = new PhotoGalery_Model_Images();
?>
<h1><?=$h1;?></h1>
<div class="main-content-list">
   <?=$this->includeTpl('sort.phtml',false,null,'articles')?>
   <div class="main-content-list-records">
   <?if(!empty ($this->articles)) {
      foreach ($this->articles as $article) {
         $noPClass = $noPubllic = null;
         if($article->{Articles_Model_Detail::COLUMN_PUBLIC} == 0){
            $noPClass = 'main-content-no-public';
            $noPubllic = $this->_('Nezveřejněno');
         }
         $addDate = new DateTime($article->{Articles_Model_Detail::COLUMN_ADD_TIME});
         ?>
   <div class="main-content-list-record <?=$noPClass?>">
      <h2><a href="<?=$this->link()->route('detail', array('urlkey' => $article->{Articles_Model_Detail::COLUMN_URLKEY}))?>"
             title="<?=htmlspecialchars($article->{Articles_Model_Detail::COLUMN_NAME})?>"><?=htmlspecialchars($article->{Articles_Model_Detail::COLUMN_NAME})?>&nbsp;
            <span class="font-small"><?=strftime("%x %X", $addDate->format("U"))?> - <?=$article->{Model_Users::COLUMN_USERNAME}?></span>
         </a><span class="font-small"><?=$noPubllic?></span>
      </h2>
      <div class="main-content-list-record-images">
      <?
      $images = $modelImages->getImages($this->category()->getId(), 
              $article->{Articles_Model_Detail::COLUMN_ID},
              $this->category()->getParam('imagesinlist', Photogalerymed_Controller::DEFAULT_IMAGES_IN_LIST));
      while ($row = $images->fetch()) {?>
      <img alt="<?=$row->{PhotoGalery_Model_Images::COLUMN_NAME}?>" 
           src="<?=$this->category()->getModule()->getDataDir(true).
              $article[Articles_Model_Detail::COLUMN_URLKEY][Locales::getDefaultLang()]
              .URL_SEPARATOR.Photogalery_Controller::DIR_SMALL
              .URL_SEPARATOR.$row->{PhotoGalery_Model_Images::COLUMN_FILE}?>" />
      <?}?>
      </div>
      <hr class="reseter" />
      <p style="float:left;"><?=$this->_('Zobrazeno')?>:&nbsp;<?=$article->{Articles_Model_Detail::COLUMN_SHOWED}?>&times;</p>
      <p style="text-align:right;">
         <a href="<?=$this->link()->route('detail', array('urlkey' => $article->{Articles_Model_Detail::COLUMN_URLKEY}))?>"
            title="<?=$article->{Articles_Model_Detail::COLUMN_NAME}?>">[&nbsp;<?=$this->_("více")?>&nbsp;]</a>
      </p>
      <br />
      </div>
     <?}?>
     <?
      echo $this->scrollComp;
   } else {
      echo ($this->_('Není vložena žádná galerie'));
   }
   echo $this->toolbox;
   ?>
   </div>
   <?
   // rss ikony
   $feeds = new Component_Feed();
   $feeds->setConfig('feedLink', $this->link()->clear());
   $feeds->mainView();
   echo $feeds;
   ?>
</div>
