function openInNewTab(e){var t=window.open(e,"_blank");t.focus()}(function(e){e.fn.disableSelection=function(){return this.attr("unselectable","on").css("user-select","none").on("selectstart",false)}})(jQuery);Storage.prototype.setObj=function(e,t){return this.setItem(e,JSON.stringify(t))};Storage.prototype.getObj=function(e){return JSON.parse(this.getItem(e))};var CubeBrowser={params:{uploadLink:null,baseUrl:null,sessionId:null,listType:"images",imageBigSizeW:1024,imageBigSizeH:768,imageSmallSizeW:200,imageSmallSizeH:200,cookieName:"Cube_Cms_brpath",baseListPath:"/home/",openDir:null,translations:{}},listType:null,currentPath:"/public/",currentAccess:{read:true,write:false},win:null,category:0,init:function(e){$.extend(this.params,e);this.listType=tinyMCEPopup.getWindowArg("listType");this.win=tinyMCEPopup.getWindowArg("window");this.category=tinyMCEPopup.getWindowArg("cat");var t=tinyMCEPopup.getWindowArg("url");if(t!==""){var n=/data(\/.*\/)[a-z0-9._-]+/i;var r=t.match(n);if(r){this.params.baseListPath=r[1]}}else{var i=localStorage.getItem("lastpath");if(i!==null){this.params.baseListPath=i}}CubeBrowserPathWidget.init();CubeBrowserPreviewWidget.init();CubeBrowserListWidget.init(this.params.baseListPath);CubeBrowserTipsWidget.init();CubeBrowserToolboxWidget.init();CubeBrowserFileActionsWidget.init();CubeBrowserUploader.init(this.params);CubeBrowserLogsWidget.init();CubeBrowserProgressBarWidget.init();CubeBrowserFilterWidget.init();CubeBrowserClipBoardWidget.init()},submitFile:function(e){this.win.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=e;if(typeof this.win.ImageDialog!=="undefined"){if(this.win.ImageDialog.getImageData){this.win.ImageDialog.getImageData()}if(this.win.ImageDialog.showPreviewImage){this.win.ImageDialog.showPreviewImage(CubeBrowserListWidget.getSelectedItems().first().data("realpath"))}}tinyMCEPopup.close()},getCurrentPath:function(){return this.currentPath},setCurrentPath:function(e){this.currentPath=e;localStorage.setItem("lastpath",e)},getCurrentAccess:function(){return this.currentAccess},setCurrentAccess:function(e){this.currentAccess=e},request:function(e,t,n,r){$.ajax({type:"POST",data:t,url:window.location.toString().replace("browser.php",e+".php"),cache:false,success:function(e){if($.isFunction(n)){n.call(e)}if(e.infomsg.length>0){$.each(e.infomsg,function(e,t){CubeBrowserLogsWidget.add(t,"info")})}if(e.errmsg.length>0){$.each(e.errmsg,function(e,t){CubeBrowserLogsWidget.add(t,"err")})}},error:function(){},complete:function(){}})},submitSelectedFile:function(){var e=CubeBrowserListWidget.getSelectedItems();e.each(function(){if($(this).data("itemclass")!=="dir"&&$(this).data("itemclass")!=="dot"){CubeBrowser.submitFile($(this).data("realpath"));return}})},loadDirectories:function(){var e=$(".directory-select");$.ajax({type:"GET",url:window.location.toString().replace("browser.php","getdirs.php"),cache:false,async:false,success:function(t){e.html("");var n=$("<optgroup></optgroup>").prop("label","Veřejné adresáře");$.each(t.dirsPublic,function(e,t){n.append($("<option></option>").prop("value",t).text(t))});e.append(n);var r=$("<optgroup></optgroup>").prop("label","Adresáře v domovské složce");$.each(t.dirsHome,function(e,t){r.append($("<option></option>").prop("value",t).text(t))});e.append(r)}})},openMoveDialog:function(){$("#dialog-move").fadeIn(300)},openRenameDialog:function(e){if(typeof e==="undefined"){e=CubeBrowserListWidget.getSelectedItems().first()}var t=$(e).closest("li");$("#dialog-rename").fadeIn(300).find('input[type="text"]').val(t.data("name"))},openCopyDialog:function(){$("#dialog-copy").fadeIn(300)},openNewDirDialog:function(){$("#dialog-new-dir").fadeIn(300)},openDeleteDialog:function(e){var t=new Array;if(typeof e==="undefined"){CubeBrowserListWidget.getSelectedItems().each(function(e){t.push($(this).data("name"))})}else{var n=$(e).closest("li");t.push(n.data("name"))}$("#dialog-delete").find(".files-list").text(t.join(", "));$("#dialog-delete").fadeIn(300)},closeDialog:function(e){$(e).closest(".dialog").fadeOut(300)},renameItem:function(e){var t=this;var n=CubeBrowserListWidget.getSelectedItems().first();this.request("rename",{item:n.data("realpath"),name:e},function(){CubeBrowserListWidget.refreshPath()})},renameItems:function(e){var t=CubeBrowserListWidget.getSelectedItems().filter(".item-image");var n=t.length;var r=this;var i=$("#image-flip");if(n===0){CubeBrowserLogsWidget.add("Nebyl vybrán žádný soubor","err");return}var s=Math.round(100/t.length);CubeBrowserProgressBarWidget.setProgress(0);t.each(function(){CubeBrowser.request("rename",{item:$(this).data("realpath"),name:e},function(){CubeBrowserProgressBarWidget.addProgress(s);n--;if(n===0){CubeBrowserProgressBarWidget.setProgress(100);CubeBrowserListWidget.refreshPath()}})})},deleteItem:function(e){},moveSelectedItems:function(e){var t=CubeBrowserListWidget.getSelectedItems();var n=t.length;var r=Math.round(100/t.length);CubeBrowserProgressBarWidget.setProgress(0);t.each(function(){CubeBrowser.request("move",{item:$(this).data("realpath"),target:e},function(){CubeBrowserProgressBarWidget.addProgress(r);n--;if(n===0){CubeBrowserProgressBarWidget.setProgress(100);CubeBrowserListWidget.refreshPath()}})})},copySelectedItems:function(e){var t=CubeBrowserListWidget.getSelectedItems();var n=t.length;var r=Math.round(100/t.length);CubeBrowserProgressBarWidget.setProgress(0);t.each(function(){CubeBrowser.request("copy",{item:$(this).data("realpath"),target:e},function(){CubeBrowserProgressBarWidget.addProgress(r);n--;if(n===0){CubeBrowserProgressBarWidget.setProgress(100);CubeBrowserListWidget.refreshPath()}})})},deleteSelectedItems:function(){var e=CubeBrowserListWidget.getSelectedItems();var t=e.length;var n=this;var r=Math.round(100/e.length);CubeBrowserProgressBarWidget.setProgress(0);e.each(function(){n.request("delete",{item:$(this).data("realpath")},function(){CubeBrowserProgressBarWidget.addProgress(r);t--;if(t===0){CubeBrowserProgressBarWidget.setProgress(100);CubeBrowserListWidget.refreshPath()}})})},createDir:function(e){var t=this;this.request("createDir",{item:CubeBrowser.getCurrentPath(),name:e},function(){CubeBrowserListWidget.refreshPath();$('#form-new-dir input[name="newname"]').val("");t.loadDirectories()})}};var CubeBrowserListWidget={$browser:null,$area:null,path:null,lastSelecteRow:false,previewTimer:false,currentFolder:false,init:function(e){this.$browser=$("#browser");this.$area=this.$browser.find(".list");this.path=e;this.loadDefaultPath();var t=this;$(this.$area).on("click","li,.name a",function(e){var n=$(this);if(n.is("a")){n=$(this).closest("li")}if(n.data("type")==="dot"){return false}if(!e.ctrlKey&&!e.shiftKey){t.unSelectAllItems()}if(e.shiftKey&&t.lastSelecteRow){var r=t.lastSelecteRow;var i=r.index()<n.index()?r.index():n.index();var s=r.index()<n.index()?n.index():r.index();t.getAllItems().slice(i,s).each(function(){t.selectItem($(this))})}if(e.ctrlKey&&t.lastSelecteRow&&t.isSelected(n)){t.unSelectItem(n)}else{t.selectItem(n)}return false});$(this.$area).on("click","li .selector input",function(e){e.stopPropagation();if($(this).is(":checked")){t.selectItem($(this).closest("li"))}else{t.unSelectItem($(this).closest("li"))}return});$(this.$area).on("click","li .selector label",function(e){if($(this).prev("input").is(":checked")){t.selectItem($(this).closest("li"))}else{t.unSelectItem($(this).closest("li"))}e.stopPropagation()});$(this.$area).on("dblclick","li,.name a",function(){var e=$(this);if(e.is("a")){e=$(this).closest("li")}if(e.data("type")==="dot"||e.data("type")==="dir"){t.loadPath(e.data("target"))}else{CubeBrowser.submitFile(e.data("realpath"))}return false});$(this.$area).on("mouseenter",".name a",function(){var e=$(this).closest("li");if(t.previewTimer){clearTimeout(t.previewTimer);t.previewTimer=null}t.previewTimer=setTimeout(function(){t.showImagePreview(e)},500)});$(this.$area).on("mouseleave",".name a",function(){var e=$(this).closest("li");clearTimeout(t.previewTimer);t.previewTimer=null;t.hideImagePreview(e)});$(this.$area).on("dragenter","li",function(e){e.stopPropagation();$(this).addClass("draging");console.log("enter")}).on("dragover","li",function(e){e.stopPropagation();$(this).addClass("draging")}).on("dragleave","li",function(e){e.stopPropagation();$(this).removeClass("draging");console.log("leave")});$(this.$area).parent().on("dragenter","ul,#drop-area",function(e){e.stopPropagation();e.preventDefault()}).on("dragover","ul,#drop-area",function(e){e.stopPropagation();e.preventDefault();$(this).addClass("draging")}).on("dragleave","ul,#drop-area",function(e){e.stopPropagation();$(this).removeClass("draging")}).on("drop","ul,#drop-area",function(e){e.stopPropagation();e.preventDefault();$(this).removeClass("draging");var t=e.originalEvent.dataTransfer.files;CubeBrowserUploader.handleFileUpload(t)}).on("drop","li",function(e){e.stopPropagation();e.preventDefault();$(this).removeClass("draging");var t=e.originalEvent.dataTransfer.files;var n=$(this).data();if(n.itemclass==="dir"||n.itemclass==="dot"){if(n.access.write===true){CubeBrowserUploader.handleFileUpload(t,n.target)}else{tinyMCEPopup.alert("Do tohoto adresáře není možné ukládat")}}else{CubeBrowserUploader.handleFileUpload(t)}});$(this.$area).on("click","a.button-open-external",function(e){e.stopPropagation();openInNewTab(this.href);return false})},selectItem:function(e){e.addClass("active").find('input[type="checkbox"]').prop("checked",true);this.lastSelecteRow=e;CubeBrowserPreviewWidget.hidePreview();if(e.data("itemclass")==="image"){CubeBrowserPreviewWidget.showPreview(e)}this.updateSubmitButton();console.log("item selected");CubeBrowserFileActionsWidget.updateActions();CubeBrowserToolboxWidget.updateButtons()},unSelectItem:function(e){e.removeClass("active").find('input[type="checkbox"]').prop("checked",false);CubeBrowserFileActionsWidget.updateActions();CubeBrowserToolboxWidget.updateButtons()},unSelectAllItems:function(){this.getSelectedItems().each(function(){CubeBrowserListWidget.unSelectItem($(this))})},isSelected:function(e){return e.hasClass("active")},loadPath:function(e,t,n){if(typeof t==="undefined"){t=false}if(typeof n==="undefined"){n=false}if(e===this.path&&this.$area.find("li").length>0&&t===false){return}var r=[];if(n){this.getSelectedItems().each(function(){r.push($(this).data("realpath"))})}var i=this;this.clearList();CubeBrowserPathWidget.setPath(e);$.ajax({type:"GET",data:{path:e,type:CubeBrowser.listType},url:window.location.toString().replace("browser.php","getitems.php"),cache:false,async:false,success:function(e){if(e.errmsg.length===0){$.each(e.items,function(e,t){i.createRow(t)});i.path=e.current;i.currentFolder=e;CubeBrowser.setCurrentPath(e.current);CubeBrowser.setCurrentAccess(e.access);if(r.length>0){$("li",i.$area).each(function(){if($.inArray($(this).data("realpath"),r)!==-1){i.selectItem($(this))}})}}else{alert(e.errmsg.join(", "))}CubeBrowserToolboxWidget.updateButtons();CubeBrowser.loadDirectories();console.log("path loaded")},error:function(){}});this.updateSubmitButton()},getFolderUp:function(){var e=null;if(this.currentFolder&&this.currentFolder.current==="/"){e=this.currentFolder.current+"/"}else{e=this.$area.find("li").first().data("target")}this.loadPath(e)},refreshPath:function(){this.loadPath(this.path,true,true)},loadDefaultPath:function(){this.loadPath(this.path)},createRow:function(e){var t=$("#item-tpl li").first().clone();var n=Math.round(Math.random()*1e7);t.prop("id","item-"+n);t.find(".filename").text(e.name);var r=e.info.sizeFormated;if(e.info.dimension.w!==0){r+=" ("+e.info.dimension.w+"x"+e.info.dimension.h+"px)"}t.find(".size").text(r);if(e.access.write===false){t.addClass("readonly")}t.find('input[type="checkbox"]').prop("id","checkbox-"+n);t.find('input[type="checkbox"]').next("label").prop("for","checkbox-"+n);t.data(e);t.disableSelection();if(e.type==="dot"||e.access.write===false){t.find(".actions").remove()}if(e.type==="dot"){t.find(".selector input").remove();t.find(".selector label").remove();t.find("a.button-open-external").remove();t.find(".preview").remove()}else if(e.type==="dir"){if(e.itemclass==="home"){t.find(".name .icon").addClass("icon-home")}else if(e.itemclass==="public"){t.find(".name .icon").addClass("icon-globe")}else{t.find(".name .icon").addClass("icon-folder-o")}t.addClass("item-dir");t.find(".preview").remove();t.find("a.button-open-external").remove()}else if(e.type==="file"){if(e.itemclass==="image"){t.addClass("item-image");t.find(".name .icon").addClass("icon-picture-o");t.find(".preview img").prop("src",CubeBrowser.params.baseUrl+e.realpath+"?h="+encodeURIComponent(r))}else if(e.itemclass==="video"){t.addClass("item-video");t.find(".name .icon").addClass("icon-video-camera");t.find(".preview").remove()}else if(e.itemclass==="flash"){t.addClass("item-flash");t.find(".name .icon").addClass("icon-falsh");t.find(".preview").remove()}else{t.addClass("item-text");t.find(".name .icon").addClass("icon-file-text");t.find(".preview").remove()}t.find("a.button-open-external").prop("href",CubeBrowser.params.baseUrl+e.realpath)}this.$area.append(t)},clearList:function(){this.$area.find("li").remove();this.lastSelecteRow=false},getAllItems:function(){return this.$area.find("li")},getSelectedItems:function(){return this.$area.find("li.active")},getItem:function(){},showImagePreview:function(e){e.find(".preview").show()},hideImagePreview:function(e){e.find(".preview").hide()},updateSubmitButton:function(){var e=this.getSelectedItems();$("#button-insert").prop("disabled",true);if(e.length===1){if(e.first().data("itemclass")!=="dir"&&e.first().data("itemclass")!=="dot"){$("#button-insert").prop("disabled",false)}}}};var CubeBrowserTipsWidget={$area:null,init:function(e){this.$area=$("#tip-content");this.showRandomTip();var t=this;$("#button-show-tips").on("click",function(){if(t.$area.is(":visible")){t.$area.hide()}else{t.$area.slideDown()}return false})},showRandomTip:function(){this.hideTips();var e=Math.round(Math.random()*this.$area.find("p").length);this.$area.find("p").eq(e-1).show()},hideTips:function(){this.$area.find("p").hide()}};var CubeBrowserLogsWidget={$area:null,init:function(){this.$area=$("#logs .list")},add:function(e,t,n){if(typeof t==="undefined"){t="info"}var r=$("<li></li>").addClass("msg").data("created",(new Date).getTime()).html(e);switch(t){case"info":r.addClass("msg-info");break;case"warn":r.addClass("msg-warning");break;case"err":r.addClass("msg-error");break}if(typeof n!=="undefined"){r.append(n)}this.$area.append(r);this.$area.scrollTop(this.$area[0].scrollHeight-this.$area.height())},clear:function(){this.$area.html(null)}};var CubeBrowserClipBoardWidget={$area:null,$list:null,init:function(){this.$area=$("#clipboard");this.$list=$(".list",this.$area);var e=localStorage.getObj("clipboard");if(e===null){e=[]}localStorage.setObj("clipboard",e);this.createItems(e)},isEmpty:function(){var e=localStorage.getObj("clipboard");return e!==null&&e.length>0?false:true},clear:function(){localStorage.setObj("clipboard",[]);this.$list.html("")},addItem:function(e){},createItems:function(e){var t=this;this.$list.html("");$.each(e,function(e,n){var r=$("<li></li>").addClass(n.type==="cut"?"item-cut":"item-copy").html(n.path);t.$list.append(r)})},copySelected:function(){var e=CubeBrowserListWidget.getSelectedItems();var t=[];e.each(function(){t.push({name:$(this).data("name"),path:$(this).data("realpath"),type:"copy"})});localStorage.setObj("clipboard",t);this.createItems(t)},cutSelected:function(){var e=CubeBrowserListWidget.getSelectedItems();var t=[];e.each(function(){t.push({name:$(this).data("name"),path:$(this).data("realpath"),type:"cut"})});localStorage.setObj("clipboard",t);this.createItems(t)},paste:function(){var e=localStorage.getObj("clipboard");var t=Math.round(100/e.length);CubeBrowserProgressBarWidget.setProgress(0);var n=e.length;$.each(e,function(e,r){CubeBrowser.request(r.type==="cut"?"move":"copy",{item:r.path,target:CubeBrowser.getCurrentPath()},function(){CubeBrowserProgressBarWidget.addProgress(t);n--;if(n===0){if(r.type==="cut"){CubeBrowserClipBoardWidget.clear()}CubeBrowserProgressBarWidget.setProgress(100);CubeBrowserListWidget.refreshPath()}})})}};var CubeBrowserToolboxWidget={$area:null,init:function(){this.$area=$("#toolbox");this.updateButtons()},updateButtons:function(){var e=CubeBrowserListWidget.getSelectedItems();if(CubeBrowserListWidget.currentFolder){if(CubeBrowserListWidget.currentFolder.access.write){$("#toolbox-button-clipboard-paste, #button-create-folder, #toolbox-button-upload",this.$area).prop("disabled",false)}else{$("#toolbox-button-clipboard-paste, #button-create-folder, #toolbox-button-upload",this.$area).prop("disabled",true)}if(CubeBrowserListWidget.currentFolder.current==="/"){$("#toolbox-button-folder-up",this.$area).prop("disabled",true)}else{$("#toolbox-button-folder-up",this.$area).prop("disabled",false)}}var t=new Array("#toolbox-button-clipboard-cut","#toolbox-button-rename","#toolbox-button-move","#toolbox-button-delete");if(e.length>0){$(t.join(","),this.$area).prop("disabled",false);e.each(function(){if($(this).data("access").write===false){$(t.join(","),this.$area).prop("disabled",true)}});$("#toolbox-button-clipboard-copy",this.$area).prop("disabled",false);$("#toolbox-button-copy",this.$area).prop("disabled",false)}else{$(t.join(","),this.$area).prop("disabled",true);$("#toolbox-button-clipboard-copy",this.$area).prop("disabled",true);$("#toolbox-button-copy",this.$area).prop("disabled",true)}if(CubeBrowserClipBoardWidget.isEmpty()||CubeBrowser.currentAccess.write===false){$("#toolbox-button-clipboard-paste",this.$area).prop("disabled",true)}else{$("#toolbox-button-clipboard-paste",this.$area).prop("disabled",false)}}};var CubeBrowserUploader={iframeinicialized:false,uploadUrl:null,init:function(e){var t=this;this.uploadUrl=e.uploadLink;$("#toolbox-button-upload").on("click",function(){$(this).closest("form").find('input[type="file"]').click()});if(window.FileReader){$("#upload_file_1").on("change",function(){t.handleFileUpload($(this)[0].files,CubeBrowser.getCurrentPath())})}else{$("#upload_file_1").on("change",function(){$('input[name="upload_path"]').val(CubeBrowser.getCurrentPath());$(this).closest("form").submit();CubeBrowserProgressBarWidget.setProgress(10)});$("#upload_target").load(function(){if(t.iframeinicialized){var e=$("#upload_target").get(0).contentWindow.error;var n=$("#upload_target").get(0).contentWindow.info;$.each(e,function(e,t){CubeBrowserLogsWidget.add(t,"err")});$.each(n,function(e,t){CubeBrowserLogsWidget.add(t,"info")});CubeBrowserListWidget.refreshPath();CubeBrowserProgressBarWidget.setProgress(100)}else{t.iframeinicialized=true}})}},handleFileUpload:function(e,t){if(typeof t==="undefined"){t=CubeBrowser.currentPath}var n=new FormData;n.append("upload_path",t);n.append("upload_iframe",0);n.append("_upload__check",1);$.each(e,function(e,t){n.append("upload_file[]",t)});this.sendFilesToServer(n)},sendFilesToServer:function(e){var t=this;CubeBrowserProgressBarWidget.hideProgress();CubeBrowserProgressBarWidget.setText("Nahrávám");var n=$.ajax({xhr:function(){var e=$.ajaxSettings.xhr();if(e.upload){e.upload.addEventListener("progress",function(e){var t=0;var n=e.loaded||e.position;var r=e.total;if(e.lengthComputable){t=Math.ceil(n/r*100)}CubeBrowserProgressBarWidget.setProgress(t)},false)}return e},url:t.uploadUrl,type:"POST",contentType:false,processData:false,cache:false,data:e,success:function(e){CubeBrowserProgressBarWidget.setProgress(100);$.each(e.errmsg,function(e,t){CubeBrowserLogsWidget.add(t,"err")});$.each(e.infomsg,function(e,t){CubeBrowserLogsWidget.add(t,"info")});CubeBrowserListWidget.refreshPath(true)}});CubeBrowserProgressBarWidget.setAbort(function(){n.abort();CubeBrowserListWidget.refreshPath(true);CubeBrowserLogsWidget.add("nahrávání zrušeno","warn")})}};var CubeBrowserPathWidget={$area:null,init:function(){this.$area=$("#current-path");$("#form-change-path",this.$area).submit(function(){CubeBrowserListWidget.loadPath($(this).find("input").val());return false})},setPath:function(e){this.$area.find("#input-current-path").val(e)}};var CubeBrowserFilterWidget={$input:null,$list:null,init:function(){this.$input=$("#browser-filter-input");this.$input.on("keyup",function(){var e=$(this).val();if(e!==""){CubeBrowserFilterWidget.filterList(e)}else{CubeBrowserFilterWidget.showAll()}}).val("")},filterList:function(e){$("#browser .list>li").each(function(){var t=$(".filename",this).text().toLowerCase()+" "+$(".size",this).text().toLowerCase();if(t.indexOf(e)>=0){$(this).show()}else{$(this).hide()}})},showAll:function(){$("#browser .list>li").show()}};var CubeBrowserFileActionsWidget={$area:null,init:function(){this.$area=$("#file-operations");this.$selector=$("#file-operations-selector",this.$area);this.disableSelector();var e=this;this.$selector.change(function(){$("div.file-operations-box",e.$area).hide();var t=$(this).find(":selected").data("target");$(t).slideDown();if(t==="#image-resize"){e.initImageResize()}});$("#image-filter-select",this.$area).change(function(){if($(this).find(":selected").data("adv")===1){$("#fitler-settings",e.$area).show();$("#fitler-settings span",e.$area).text($(this).find(":selected").data("advtitle"));$('#fitler-settings input[name="filter_arg"]',e.$area).val($(this).find(":selected").data("advdefault"))}else{$("#fitler-settings",e.$area).hide()}}).change()},disableSelector:function(){this.$selector.val($("option:first",this.$selector).val());this.$selector.find("option").not(":first").prop("disabled",true)},updateActions:function(){var e=this;var t=CubeBrowserListWidget.getSelectedItems();if(t.length===0){this.disableSelector();$("div.file-operations-box",this.$area).hide()}else{var n=false;var r=false;t.each(function(){if($(this).data("type")==="file"&&$(this).data("access").write===true){r=true}if($(this).data("itemclass")==="image"){n=true}});this.$selector.find("option.image-operation").prop("disabled",!n);this.$selector.find("option.file-operation").prop("disabled",!r);if(!n){$("div.image-operation").hide();this.$selector.val($("option:first",this.$selector).val())}else{this.$selector.change()}if(!r){$("div.file-operation").hide();this.$selector.val($("option:first",this.$selector).val())}else{this.$selector.change()}}},initImageResize:function(){var e=$("#image-resize");$('input[name="image_size_x"]',e).val(CubeBrowserPreviewWidget.realWidth);$('input[name="image_size_y"]',e).val(CubeBrowserPreviewWidget.realHeight);$('input[name="image_size_x"]',e).off("change").on("change",function(){if($('input[name="mantain_ratio"]',e).is(":checked")){var t=CubeBrowserPreviewWidget.realWidth/CubeBrowserPreviewWidget.realHeight;$('input[name="image_size_y"]',e).val(Math.round($(this).val()/t))}});$('input[name="image_size_y"]',e).off("change").on("change",function(){if($('input[name="mantain_ratio"]',e).is(":checked")){var t=CubeBrowserPreviewWidget.realHeight/CubeBrowserPreviewWidget.realWidth;$('input[name="image_size_x"]',e).val(Math.round($(this).val()/t))}})},resizeImages:function(){var e=CubeBrowserListWidget.getSelectedItems().filter(".item-image");var t=e.length;var n=this;var r=$("#image-resize");if(t===0){CubeBrowserLogsWidget.add("Nebyl vybrán žádný obrázek","err");return}var i=Math.round(100/e.length);CubeBrowserProgressBarWidget.setProgress(0);e.each(function(){CubeBrowser.request("imageResize",{item:$(this).data("realpath"),width:$('input[name="image_size_x"]',r).val(),height:$('input[name="image_size_y"]',r).val(),ratio:$('input[name="mantain_ratio"]',r).is(":checked")?1:0,crop:$('input[name="image_crop"]',r).is(":checked")?1:0,createNew:$('input[name="create_new"]',r).is(":checked")?1:0},function(){CubeBrowserProgressBarWidget.addProgress(i);t--;if(t===0){CubeBrowserProgressBarWidget.setProgress(100);CubeBrowserListWidget.refreshPath();$("div.file-operations-box",n.$area).hide()}})})},rotateImages:function(){var e=CubeBrowserListWidget.getSelectedItems().filter(".item-image");var t=e.length;var n=this;var r=$("#image-rotate");if(t===0){CubeBrowserLogsWidget.add("Nebyl vybrán žádný obrázek","err");return}var i=Math.round(100/e.length);CubeBrowserProgressBarWidget.setProgress(0);e.each(function(){CubeBrowser.request("imageRotate",{item:$(this).data("realpath"),degree:$('select[name="degree"]',r).val(),createNew:$('input[name="create_new"]',r).is(":checked")?1:0},function(){CubeBrowserProgressBarWidget.addProgress(i);t--;if(t===0){CubeBrowserProgressBarWidget.setProgress(100);CubeBrowserListWidget.refreshPath();$("div.file-operations-box",n.$area).hide()}})})},filterImages:function(){var e=CubeBrowserListWidget.getSelectedItems().filter(".item-image");var t=e.length;var n=this;var r=$("#image-filter");if(t===0){CubeBrowserLogsWidget.add("Nebyl vybrán žádný obrázek","err");return}var i=Math.round(100/e.length);CubeBrowserProgressBarWidget.setProgress(0);e.each(function(){CubeBrowser.request("imageFilter",{item:$(this).data("realpath"),filter:$('select[name="filter"]',r).val(),arg:$('input[name="filter_arg"]',r).val(),createNew:$('input[name="create_new"]',r).is(":checked")?1:0},function(){CubeBrowserProgressBarWidget.addProgress(i);t--;if(t===0){CubeBrowserProgressBarWidget.setProgress(100);CubeBrowserListWidget.refreshPath();$("div.file-operations-box",n.$area).hide()}})})},flipImages:function(){var e=CubeBrowserListWidget.getSelectedItems().filter(".item-image");var t=e.length;var n=this;var r=$("#image-flip");if(t===0){CubeBrowserLogsWidget.add("Nebyl vybrán žádný obrázek","err");return}var i=Math.round(100/e.length);CubeBrowserProgressBarWidget.setProgress(0);e.each(function(){CubeBrowser.request("imageFlip",{item:$(this).data("realpath"),flip:$('select[name="flip"]',r).val(),createNew:$('input[name="create_new"]',r).is(":checked")?1:0},function(){CubeBrowserProgressBarWidget.addProgress(i);t--;if(t===0){CubeBrowserProgressBarWidget.setProgress(100);CubeBrowserListWidget.refreshPath();$("div.file-operations-box",n.$area).hide()}})})},watermarkImages:function(){var e=CubeBrowserListWidget.getSelectedItems().filter(".item-image");var t=e.length;var n=this;var r=$("#image-watermark");if(t===0){CubeBrowserLogsWidget.add("Nebyl vybrán žádný obrázek","err");return}if(/^[0-9a-f]{6}$/i.test($('input[name="color"]',r).val())===false){alert("Nesprávně zadaná barva textu");return false}if($('input[name="colorBg"]',r).val()!==""&&/^[0-9a-f]{6}$/i.test($('input[name="colorBg"]',r).val())===false){alert("Nesprávně zadaná barva pozadí");return false}var i=Math.round(100/e.length);CubeBrowserProgressBarWidget.setProgress(0);e.each(function(){CubeBrowser.request("imageWatermark",{item:$(this).data("realpath"),text:$('input[name="text"]',r).val(),color:$('input[name="color"]',r).val(),colorBg:$('input[name="colorBg"]',r).val(),posX:$('select[name="posX"]',r).val(),posY:$('select[name="posY"]',r).val(),createNew:$('input[name="create_new"]',r).is(":checked")?1:0},function(){CubeBrowserProgressBarWidget.addProgress(i);t--;if(t===0){CubeBrowserProgressBarWidget.setProgress(100);CubeBrowserListWidget.refreshPath();$("div.file-operations-box",n.$area).hide()}})})}};var CubeBrowserPreviewWidget={$area:null,realWidth:0,realHeight:0,init:function(){this.$area=$("#preview")},showPreview:function(e){var t=CubeBrowser.params.baseUrl+e.data("realpath")+"?time="+(new Date).getTime();this.$area.find("img").prop("src",t).show();this.$area.find("span.icon").hide();var n=this;$("<img/>").attr("src",t).load(function(){n.realWidth=this.width;n.realHeight=this.height})},hidePreview:function(){this.$area.find("img").prop("src",null).hide();this.$area.find("span.icon").show()}};var rowCount=0;var CubeBrowserProgressBarWidget={$area:null,$meter:null,text:null,progress:0,init:function(){this.$area=$("#progress-bar");this.$meter=this.$area.find("span.progress");this.$percents=this.$area.find("span.percent");this.hideProgress()},addProgress:function(e){this.setProgress(this.progress+e)},setProgress:function(e){this.$area.show();this.progress=e>=100?100:e;this.$meter.css("width",this.progress+"%");this.$percents.text((this.text!==null?this.text+" ":null)+this.progress+"%");if(this.progress===100){setTimeout(function(){CubeBrowserProgressBarWidget.hideProgress()},2e3)}},setAbort:function(e){var t=this;this.$area.find(".button-cancel").unbind("click").bind("click",function(){e.call();t.hideProgress()}).show()},hideProgress:function(){this.$area.hide();this.$meter.css("width","0%");this.$percents.text("0%");this.$area.find(".button-cancel").hide();this.text=null},setText:function(e){this.text=e}}