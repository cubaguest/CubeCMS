function openInNewTab(e){var t=window.open(e,"_blank");t.focus()}!function(e){e.fn.disableSelection=function(){return this.attr("unselectable","on").css("user-select","none").on("selectstart",!1)}}(jQuery),Storage.prototype.setObj=function(e,t){return this.setItem(e,JSON.stringify(t))},Storage.prototype.getObj=function(e){return JSON.parse(this.getItem(e))};var CubeBrowser={params:{uploadLink:null,baseUrl:null,sessionId:null,listType:"images",imageBigSizeW:1024,imageBigSizeH:768,imageSmallSizeW:200,imageSmallSizeH:200,cookieName:"Cube_Cms_brpath",baseListPath:"/home/",openDir:null,translations:{}},listType:null,currentPath:"/public/",currentAccess:{read:!0,write:!1},win:null,category:0,init:function(e){$.extend(this.params,e),this.listType=tinyMCEPopup.getWindowArg("listType"),this.win=tinyMCEPopup.getWindowArg("window"),this.category=tinyMCEPopup.getWindowArg("cat");var t=tinyMCEPopup.getWindowArg("url");if(""!==t){var r=/data(\/.*\/)[a-z0-9._-]+/i,i=t.match(r);i&&(this.params.baseListPath=i[1])}else{var a=localStorage.getItem("lastpath");null!==a&&(this.params.baseListPath=a)}CubeBrowserPathWidget.init(),CubeBrowserPreviewWidget.init(),CubeBrowserListWidget.init(this.params.baseListPath),CubeBrowserTipsWidget.init(),CubeBrowserToolboxWidget.init(),CubeBrowserFileActionsWidget.init(),CubeBrowserUploader.init(this.params),CubeBrowserLogsWidget.init(),CubeBrowserProgressBarWidget.init(),CubeBrowserFilterWidget.init(),CubeBrowserClipBoardWidget.init()},submitFile:function(e){this.win.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=e,"undefined"!=typeof this.win.ImageDialog&&(this.win.ImageDialog.getImageData&&this.win.ImageDialog.getImageData(),this.win.ImageDialog.showPreviewImage&&this.win.ImageDialog.showPreviewImage(CubeBrowserListWidget.getSelectedItems().first().data("realpath"))),tinyMCEPopup.close()},getCurrentPath:function(){return this.currentPath},setCurrentPath:function(e){this.currentPath=e,localStorage.setItem("lastpath",e)},getCurrentAccess:function(){return this.currentAccess},setCurrentAccess:function(e){this.currentAccess=e},request:function(e,t,r){$.ajax({type:"POST",data:t,url:window.location.toString().replace("browser.php",e+".php"),cache:!1,success:function(e){$.isFunction(r)&&r.call(e),e.infomsg.length>0&&$.each(e.infomsg,function(e,t){CubeBrowserLogsWidget.add(t,"info")}),e.errmsg.length>0&&$.each(e.errmsg,function(e,t){CubeBrowserLogsWidget.add(t,"err")})},error:function(){},complete:function(){}})},submitSelectedFile:function(){var e=CubeBrowserListWidget.getSelectedItems();e.each(function(){return"dir"!==$(this).data("itemclass")&&"dot"!==$(this).data("itemclass")?void CubeBrowser.submitFile($(this).data("realpath")):void 0})},loadDirectories:function(){var e=$(".directory-select");$.ajax({type:"GET",url:window.location.toString().replace("browser.php","getdirs.php"),cache:!1,async:!1,success:function(t){e.html("");var r=$("<optgroup></optgroup>").prop("label","Veřejné adresáře");$.each(t.dirsPublic,function(e,t){r.append($("<option></option>").prop("value",t).text(t))}),e.append(r);var i=$("<optgroup></optgroup>").prop("label","Adresáře v domovské složce");$.each(t.dirsHome,function(e,t){i.append($("<option></option>").prop("value",t).text(t))}),e.append(i)}})},openMoveDialog:function(){$("#dialog-move").fadeIn(300)},openRenameDialog:function(e){"undefined"==typeof e&&(e=CubeBrowserListWidget.getSelectedItems().first());var t=$(e).closest("li");$("#dialog-rename").fadeIn(300).find('input[type="text"]').val(t.data("name"))},openCopyDialog:function(){$("#dialog-copy").fadeIn(300)},openNewDirDialog:function(){$("#dialog-new-dir").fadeIn(300)},openDeleteDialog:function(e){var t=new Array;if("undefined"==typeof e)CubeBrowserListWidget.getSelectedItems().each(function(){t.push($(this).data("name"))});else{var r=$(e).closest("li");t.push(r.data("name"))}$("#dialog-delete").find(".files-list").text(t.join(", ")),$("#dialog-delete").fadeIn(300)},closeDialog:function(e){$(e).closest(".dialog").fadeOut(300)},renameItem:function(e){var t=CubeBrowserListWidget.getSelectedItems().first();this.request("rename",{item:t.data("realpath"),name:e},function(){CubeBrowserListWidget.refreshPath()})},renameItems:function(e){{var t=CubeBrowserListWidget.getSelectedItems().filter(".item-image"),r=t.length;$("#image-flip")}if(0===r)return void CubeBrowserLogsWidget.add("Nebyl vybrán žádný soubor","err");var i=Math.round(100/t.length);CubeBrowserProgressBarWidget.setProgress(0),t.each(function(){CubeBrowser.request("rename",{item:$(this).data("realpath"),name:e},function(){CubeBrowserProgressBarWidget.addProgress(i),r--,0===r&&(CubeBrowserProgressBarWidget.setProgress(100),CubeBrowserListWidget.refreshPath())})})},deleteItem:function(){},moveSelectedItems:function(e){var t=CubeBrowserListWidget.getSelectedItems(),r=t.length,i=Math.round(100/t.length);CubeBrowserProgressBarWidget.setProgress(0),t.each(function(){CubeBrowser.request("move",{item:$(this).data("realpath"),target:e},function(){CubeBrowserProgressBarWidget.addProgress(i),r--,0===r&&(CubeBrowserProgressBarWidget.setProgress(100),CubeBrowserListWidget.refreshPath())})})},copySelectedItems:function(e){var t=CubeBrowserListWidget.getSelectedItems(),r=t.length,i=Math.round(100/t.length);CubeBrowserProgressBarWidget.setProgress(0),t.each(function(){CubeBrowser.request("copy",{item:$(this).data("realpath"),target:e},function(){CubeBrowserProgressBarWidget.addProgress(i),r--,0===r&&(CubeBrowserProgressBarWidget.setProgress(100),CubeBrowserListWidget.refreshPath())})})},deleteSelectedItems:function(){var e=CubeBrowserListWidget.getSelectedItems(),t=e.length,r=this,i=Math.round(100/e.length);CubeBrowserProgressBarWidget.setProgress(0),e.each(function(){r.request("delete",{item:$(this).data("realpath")},function(){CubeBrowserProgressBarWidget.addProgress(i),t--,0===t&&(CubeBrowserProgressBarWidget.setProgress(100),CubeBrowserListWidget.refreshPath())})})},createDir:function(e){var t=this;this.request("createDir",{item:CubeBrowser.getCurrentPath(),name:e},function(){CubeBrowserListWidget.refreshPath(),$('#form-new-dir input[name="newname"]').val(""),t.loadDirectories()})}},CubeBrowserListWidget={$browser:null,$area:null,path:null,lastSelecteRow:!1,previewTimer:!1,currentFolder:!1,request:null,init:function(e){this.$browser=$("#browser"),this.$area=this.$browser.find(".list"),this.path=e,this.loadDefaultPath();var t=this;$(this.$area).on("click","li,.name a",function(e){var r=$(this);if(r.is("a")&&(r=$(this).closest("li")),"dot"===r.data("type"))return!1;if(e.ctrlKey||e.shiftKey||t.unSelectAllItems(),e.shiftKey&&t.lastSelecteRow){var i=t.lastSelecteRow,a=i.index()<r.index()?i.index():r.index(),s=i.index()<r.index()?r.index():i.index();t.getAllItems().slice(a,s).each(function(){t.selectItem($(this))})}return e.ctrlKey&&t.lastSelecteRow&&t.isSelected(r)?t.unSelectItem(r):t.selectItem(r),!1}),$(this.$area).on("click","li .selector input",function(e){e.stopPropagation(),$(this).is(":checked")?t.selectItem($(this).closest("li")):t.unSelectItem($(this).closest("li"))}),$(this.$area).on("click","li .selector label",function(e){$(this).prev("input").is(":checked")?t.selectItem($(this).closest("li")):t.unSelectItem($(this).closest("li")),e.stopPropagation()}),$(this.$area).on("dblclick","li,.name a",function(){var e=$(this);return e.is("a")&&(e=$(this).closest("li")),"dot"===e.data("type")||"dir"===e.data("type")?t.loadPath(e.data("target")):CubeBrowser.submitFile(e.data("realpath")),!1}),$(this.$area).on("mouseenter",".name a",function(){var e=$(this).closest("li");t.previewTimer&&(clearTimeout(t.previewTimer),t.previewTimer=null),t.previewTimer=setTimeout(function(){t.showImagePreview(e)},500)}),$(this.$area).on("mouseleave",".name a",function(){var e=$(this).closest("li");clearTimeout(t.previewTimer),t.previewTimer=null,t.hideImagePreview(e)}),$(this.$area).on("dragenter","li",function(e){e.stopPropagation(),$(this).addClass("draging"),console.log("enter")}).on("dragover","li",function(e){e.stopPropagation(),$(this).addClass("draging")}).on("dragleave","li",function(e){e.stopPropagation(),$(this).removeClass("draging"),console.log("leave")}),$(this.$area).parent().on("dragenter","ul,#drop-area",function(e){e.stopPropagation(),e.preventDefault()}).on("dragover","ul,#drop-area",function(e){e.stopPropagation(),e.preventDefault(),$(this).addClass("draging")}).on("dragleave","ul,#drop-area",function(e){e.stopPropagation(),$(this).removeClass("draging")}).on("drop","ul,#drop-area",function(e){e.stopPropagation(),e.preventDefault(),$(this).removeClass("draging");var t=e.originalEvent.dataTransfer.files;CubeBrowserUploader.handleFileUpload(t)}).on("drop","li",function(e){e.stopPropagation(),e.preventDefault(),$(this).removeClass("draging");var t=e.originalEvent.dataTransfer.files,r=$(this).data();"dir"===r.itemclass||"dot"===r.itemclass?r.access.write===!0?CubeBrowserUploader.handleFileUpload(t,r.target):tinyMCEPopup.alert("Do tohoto adresáře není možné ukládat"):CubeBrowserUploader.handleFileUpload(t)}),$(this.$area).on("click","a.button-open-external",function(e){return e.stopPropagation(),openInNewTab(this.href),!1})},selectItem:function(e){e.addClass("active").find('input[type="checkbox"]').prop("checked",!0),this.lastSelecteRow=e,CubeBrowserPreviewWidget.hidePreview(),"image"===e.data("itemclass")&&CubeBrowserPreviewWidget.showPreview(e),this.updateSubmitButton(),console.log("item selected"),CubeBrowserFileActionsWidget.updateActions(),CubeBrowserToolboxWidget.updateButtons()},unSelectItem:function(e){e.removeClass("active").find('input[type="checkbox"]').prop("checked",!1),CubeBrowserFileActionsWidget.updateActions(),CubeBrowserToolboxWidget.updateButtons()},unSelectAllItems:function(){this.getSelectedItems().each(function(){CubeBrowserListWidget.unSelectItem($(this))})},isSelected:function(e){return e.hasClass("active")},loadPath:function(e,t,r){if("undefined"==typeof t&&(t=!1),"undefined"==typeof r&&(r=!1),!(e===this.path&&this.$area.find("li").length>0&&t===!1)){var i=[];r&&this.getSelectedItems().each(function(){i.push($(this).data("realpath"))});var a=this;this.clearList(),CubeBrowserPathWidget.setPath(e),this.request=$.ajax({type:"GET",data:{path:e,type:CubeBrowser.listType},url:window.location.toString().replace("browser.php","getitems.php"),cache:!1,async:!1,beforeSend:function(e){null!==a.request&&a.request.abort(),a.request=e},success:function(e){e.items?($.each(e.items,function(e,t){a.createRow(t)}),a.path=e.current,a.currentFolder=e,CubeBrowser.setCurrentPath(e.current),CubeBrowser.setCurrentAccess(e.access),i.length>0&&$("li",a.$area).each(function(){-1!==$.inArray($(this).data("realpath"),i)&&a.selectItem($(this))})):alert(e.errmsg.join(", ")),CubeBrowserToolboxWidget.updateButtons(),CubeBrowser.loadDirectories()},error:function(){}}),this.updateSubmitButton()}},getFolderUp:function(){var e=null;e=this.currentFolder&&"/"===this.currentFolder.current?this.currentFolder.current+"/":this.$area.find("li").first().data("target"),this.loadPath(e)},refreshPath:function(){this.loadPath(this.path,!0,!0)},loadDefaultPath:function(){this.loadPath(this.path)},createRow:function(e){var t=$("#item-tpl li").first().clone(),r=Math.round(1e7*Math.random());t.prop("id","item-"+r),t.find(".filename").text(e.name);var i=e.info.sizeFormated;0!==e.info.dimension.w&&(i+=" ("+e.info.dimension.w+"x"+e.info.dimension.h+"px)"),t.find(".size").text(i),e.access.write===!1&&t.addClass("readonly"),t.find('input[type="checkbox"]').prop("id","checkbox-"+r),t.find('input[type="checkbox"]').next("label").prop("for","checkbox-"+r),t.data(e),t.disableSelection(),("dot"===e.type||e.access.write===!1)&&t.find(".actions").remove(),"dot"===e.type?(t.find(".selector input").remove(),t.find(".selector label").remove(),t.find("a.button-open-external").remove(),t.find(".preview").remove()):"dir"===e.type?(t.find(".name .icon").addClass("home"===e.itemclass?"icon-home":"public"===e.itemclass?"icon-globe":"icon-folder-o"),t.addClass("item-dir"),t.find(".preview").remove(),t.find("a.button-open-external").remove()):"file"===e.type&&("image"===e.itemclass?(t.addClass("item-image"),t.find(".name .icon").addClass("icon-picture-o"),t.find(".preview img").prop("src",CubeBrowser.params.baseUrl+e.realpath+"?h="+encodeURIComponent(i))):"video"===e.itemclass?(t.addClass("item-video"),t.find(".name .icon").addClass("icon-video-camera"),t.find(".preview").remove()):"flash"===e.itemclass?(t.addClass("item-flash"),t.find(".name .icon").addClass("icon-falsh"),t.find(".preview").remove()):(t.addClass("item-text"),t.find(".name .icon").addClass("icon-file-text"),t.find(".preview").remove()),t.find("a.button-open-external").prop("href",CubeBrowser.params.baseUrl+e.realpath)),this.$area.append(t)},clearList:function(){this.$area.find("li").remove(),this.lastSelecteRow=!1},getAllItems:function(){return this.$area.find("li")},getSelectedItems:function(){return this.$area.find("li.active")},getItem:function(){},showImagePreview:function(e){e.find(".preview").show()},hideImagePreview:function(e){e.find(".preview").hide()},updateSubmitButton:function(){var e=this.getSelectedItems();$("#button-insert").prop("disabled",!0),1===e.length&&"dir"!==e.first().data("itemclass")&&"dot"!==e.first().data("itemclass")&&$("#button-insert").prop("disabled",!1)}},CubeBrowserTipsWidget={$area:null,init:function(){this.$area=$("#tip-content"),this.showRandomTip();var e=this;$("#button-show-tips").on("click",function(){return e.$area.is(":visible")?e.$area.hide():e.$area.slideDown(),!1})},showRandomTip:function(){this.hideTips();var e=Math.round(Math.random()*this.$area.find("p").length);this.$area.find("p").eq(e-1).show()},hideTips:function(){this.$area.find("p").hide()}},CubeBrowserLogsWidget={$area:null,init:function(){this.$area=$("#logs .list")},add:function(e,t,r){"undefined"==typeof t&&(t="info");var i=$("<li></li>").addClass("msg").data("created",(new Date).getTime()).html(e);switch(t){case"info":i.addClass("msg-info");break;case"warn":i.addClass("msg-warning");break;case"err":i.addClass("msg-error")}"undefined"!=typeof r&&i.append(r),this.$area.append(i),this.$area.scrollTop(this.$area[0].scrollHeight-this.$area.height())},clear:function(){this.$area.html(null)}},CubeBrowserClipBoardWidget={$area:null,$list:null,init:function(){this.$area=$("#clipboard"),this.$list=$(".list",this.$area);var e=localStorage.getObj("clipboard");null===e&&(e=[]),localStorage.setObj("clipboard",e),this.createItems(e)},isEmpty:function(){var e=localStorage.getObj("clipboard");return null!==e&&e.length>0?!1:!0},clear:function(){localStorage.setObj("clipboard",[]),this.$list.html("")},addItem:function(){},createItems:function(e){var t=this;this.$list.html(""),$.each(e,function(e,r){var i=$("<li></li>").addClass("cut"===r.type?"item-cut":"item-copy").html(r.path);t.$list.append(i)})},copySelected:function(){var e=CubeBrowserListWidget.getSelectedItems(),t=[];e.each(function(){t.push({name:$(this).data("name"),path:$(this).data("realpath"),type:"copy"})}),localStorage.setObj("clipboard",t),this.createItems(t)},cutSelected:function(){var e=CubeBrowserListWidget.getSelectedItems(),t=[];e.each(function(){t.push({name:$(this).data("name"),path:$(this).data("realpath"),type:"cut"})}),localStorage.setObj("clipboard",t),this.createItems(t)},paste:function(){var e=localStorage.getObj("clipboard"),t=Math.round(100/e.length);CubeBrowserProgressBarWidget.setProgress(0);var r=e.length;$.each(e,function(e,i){CubeBrowser.request("cut"===i.type?"move":"copy",{item:i.path,target:CubeBrowser.getCurrentPath()},function(){CubeBrowserProgressBarWidget.addProgress(t),r--,0===r&&("cut"===i.type&&CubeBrowserClipBoardWidget.clear(),CubeBrowserProgressBarWidget.setProgress(100),CubeBrowserListWidget.refreshPath())})})}},CubeBrowserToolboxWidget={$area:null,init:function(){this.$area=$("#toolbox"),this.updateButtons()},updateButtons:function(){var e=CubeBrowserListWidget.getSelectedItems();CubeBrowserListWidget.currentFolder&&(CubeBrowserListWidget.currentFolder.access.write?$("#toolbox-button-clipboard-paste, #button-create-folder, #toolbox-button-upload",this.$area).prop("disabled",!1):$("#toolbox-button-clipboard-paste, #button-create-folder, #toolbox-button-upload",this.$area).prop("disabled",!0),"/"===CubeBrowserListWidget.currentFolder.current?$("#toolbox-button-folder-up",this.$area).prop("disabled",!0):$("#toolbox-button-folder-up",this.$area).prop("disabled",!1));var t=new Array("#toolbox-button-clipboard-cut","#toolbox-button-rename","#toolbox-button-move","#toolbox-button-delete");e.length>0?($(t.join(","),this.$area).prop("disabled",!1),e.each(function(){$(this).data("access").write===!1&&$(t.join(","),this.$area).prop("disabled",!0)}),$("#toolbox-button-clipboard-copy",this.$area).prop("disabled",!1),$("#toolbox-button-copy",this.$area).prop("disabled",!1)):($(t.join(","),this.$area).prop("disabled",!0),$("#toolbox-button-clipboard-copy",this.$area).prop("disabled",!0),$("#toolbox-button-copy",this.$area).prop("disabled",!0)),CubeBrowserClipBoardWidget.isEmpty()||CubeBrowser.currentAccess.write===!1?$("#toolbox-button-clipboard-paste",this.$area).prop("disabled",!0):$("#toolbox-button-clipboard-paste",this.$area).prop("disabled",!1)}},CubeBrowserUploader={iframeinicialized:!1,uploadUrl:null,init:function(e){var t=this;this.uploadUrl=e.uploadLink,$("#toolbox-button-upload").on("click",function(){$(this).closest("form").find('input[type="file"]').click()}),window.FileReader?$("#upload_file_1").on("change",function(){t.handleFileUpload($(this)[0].files,CubeBrowser.getCurrentPath())}):($("#upload_file_1").on("change",function(){$('input[name="upload_path"]').val(CubeBrowser.getCurrentPath()),$(this).closest("form").submit(),CubeBrowserProgressBarWidget.setProgress(10)}),$("#upload_target").load(function(){if(t.iframeinicialized){var e=$("#upload_target").get(0).contentWindow.error,r=$("#upload_target").get(0).contentWindow.info;$.each(e,function(e,t){CubeBrowserLogsWidget.add(t,"err")}),$.each(r,function(e,t){CubeBrowserLogsWidget.add(t,"info")}),CubeBrowserListWidget.refreshPath(),CubeBrowserProgressBarWidget.setProgress(100)}else t.iframeinicialized=!0}))},handleFileUpload:function(e,t){"undefined"==typeof t&&(t=CubeBrowser.currentPath);var r=new FormData;r.append("upload_path",t),r.append("upload_iframe",0),r.append("_upload__check",1),$.each(e,function(e,t){r.append("upload_file[]",t)}),this.sendFilesToServer(r)},sendFilesToServer:function(e){var t=this;CubeBrowserProgressBarWidget.hideProgress(),CubeBrowserProgressBarWidget.setText("Nahrávám");var r=$.ajax({xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){var t=0,r=e.loaded||e.position,i=e.total;e.lengthComputable&&(t=Math.ceil(r/i*100)),CubeBrowserProgressBarWidget.setProgress(t)},!1),e},url:t.uploadUrl,type:"POST",contentType:!1,processData:!1,cache:!1,data:e,success:function(e){CubeBrowserProgressBarWidget.setProgress(100),$.each(e.errmsg,function(e,t){CubeBrowserLogsWidget.add(t,"err")}),$.each(e.infomsg,function(e,t){CubeBrowserLogsWidget.add(t,"info")}),CubeBrowserListWidget.refreshPath(!0)}});CubeBrowserProgressBarWidget.setAbort(function(){r.abort(),CubeBrowserListWidget.refreshPath(!0),CubeBrowserLogsWidget.add("nahrávání zrušeno","warn")})}},CubeBrowserPathWidget={$area:null,init:function(){this.$area=$("#current-path"),$("#form-change-path",this.$area).submit(function(){return CubeBrowserListWidget.loadPath($(this).find("input").val()),!1})},setPath:function(e){this.$area.find("#input-current-path").val(e)}},CubeBrowserFilterWidget={$input:null,$list:null,init:function(){this.$input=$("#browser-filter-input"),this.$input.on("keyup",function(){var e=$(this).val();""!==e?CubeBrowserFilterWidget.filterList(e):CubeBrowserFilterWidget.showAll()}).val("")},filterList:function(e){$("#browser .list>li").each(function(){var t=$(".filename",this).text().toLowerCase()+" "+$(".size",this).text().toLowerCase();t.indexOf(e)>=0?$(this).show():$(this).hide()})},showAll:function(){$("#browser .list>li").show()}},CubeBrowserFileActionsWidget={$area:null,init:function(){this.$area=$("#file-operations"),this.$selector=$("#file-operations-selector",this.$area),this.disableSelector();var e=this;this.$selector.change(function(){$("div.file-operations-box",e.$area).hide();var t=$(this).find(":selected").data("target");$(t).slideDown(),"#image-resize"===t&&e.initImageResize()}),$("#image-filter-select",this.$area).change(function(){1===$(this).find(":selected").data("adv")?($("#fitler-settings",e.$area).show(),$("#fitler-settings span",e.$area).text($(this).find(":selected").data("advtitle")),$('#fitler-settings input[name="filter_arg"]',e.$area).val($(this).find(":selected").data("advdefault"))):$("#fitler-settings",e.$area).hide()}).change()},disableSelector:function(){this.$selector.val($("option:first",this.$selector).val()),this.$selector.find("option").not(":first").prop("disabled",!0)},updateActions:function(){var e=CubeBrowserListWidget.getSelectedItems();if(0===e.length)this.disableSelector(),$("div.file-operations-box",this.$area).hide();else{var t=!1,r=!1;e.each(function(){"file"===$(this).data("type")&&$(this).data("access").write===!0&&(r=!0),"image"===$(this).data("itemclass")&&(t=!0)}),this.$selector.find("option.image-operation").prop("disabled",!t),this.$selector.find("option.file-operation").prop("disabled",!r),t?this.$selector.change():($("div.image-operation").hide(),this.$selector.val($("option:first",this.$selector).val())),r?this.$selector.change():($("div.file-operation").hide(),this.$selector.val($("option:first",this.$selector).val()))}},initImageResize:function(){var e=$("#image-resize");$('input[name="image_size_x"]',e).val(CubeBrowserPreviewWidget.realWidth),$('input[name="image_size_y"]',e).val(CubeBrowserPreviewWidget.realHeight),$('input[name="image_size_x"]',e).off("change").on("change",function(){if($('input[name="mantain_ratio"]',e).is(":checked")){var t=CubeBrowserPreviewWidget.realWidth/CubeBrowserPreviewWidget.realHeight;$('input[name="image_size_y"]',e).val(Math.round($(this).val()/t))}}),$('input[name="image_size_y"]',e).off("change").on("change",function(){if($('input[name="mantain_ratio"]',e).is(":checked")){var t=CubeBrowserPreviewWidget.realHeight/CubeBrowserPreviewWidget.realWidth;$('input[name="image_size_x"]',e).val(Math.round($(this).val()/t))}})},resizeImages:function(){var e=CubeBrowserListWidget.getSelectedItems().filter(".item-image"),t=e.length,r=this,i=$("#image-resize");if(0===t)return void CubeBrowserLogsWidget.add("Nebyl vybrán žádný obrázek","err");var a=Math.round(100/e.length);CubeBrowserProgressBarWidget.setProgress(0),e.each(function(){CubeBrowser.request("imageResize",{item:$(this).data("realpath"),width:$('input[name="image_size_x"]',i).val(),height:$('input[name="image_size_y"]',i).val(),ratio:$('input[name="mantain_ratio"]',i).is(":checked")?1:0,crop:$('input[name="image_crop"]',i).is(":checked")?1:0,createNew:$('input[name="create_new"]',i).is(":checked")?1:0},function(){CubeBrowserProgressBarWidget.addProgress(a),t--,0===t&&(CubeBrowserProgressBarWidget.setProgress(100),CubeBrowserListWidget.refreshPath(),$("div.file-operations-box",r.$area).hide())})})},rotateImages:function(){var e=CubeBrowserListWidget.getSelectedItems().filter(".item-image"),t=e.length,r=this,i=$("#image-rotate");if(0===t)return void CubeBrowserLogsWidget.add("Nebyl vybrán žádný obrázek","err");var a=Math.round(100/e.length);CubeBrowserProgressBarWidget.setProgress(0),e.each(function(){CubeBrowser.request("imageRotate",{item:$(this).data("realpath"),degree:$('select[name="degree"]',i).val(),createNew:$('input[name="create_new"]',i).is(":checked")?1:0},function(){CubeBrowserProgressBarWidget.addProgress(a),t--,0===t&&(CubeBrowserProgressBarWidget.setProgress(100),CubeBrowserListWidget.refreshPath(),$("div.file-operations-box",r.$area).hide())})})},filterImages:function(){var e=CubeBrowserListWidget.getSelectedItems().filter(".item-image"),t=e.length,r=this,i=$("#image-filter");if(0===t)return void CubeBrowserLogsWidget.add("Nebyl vybrán žádný obrázek","err");var a=Math.round(100/e.length);CubeBrowserProgressBarWidget.setProgress(0),e.each(function(){CubeBrowser.request("imageFilter",{item:$(this).data("realpath"),filter:$('select[name="filter"]',i).val(),arg:$('input[name="filter_arg"]',i).val(),createNew:$('input[name="create_new"]',i).is(":checked")?1:0},function(){CubeBrowserProgressBarWidget.addProgress(a),t--,0===t&&(CubeBrowserProgressBarWidget.setProgress(100),CubeBrowserListWidget.refreshPath(),$("div.file-operations-box",r.$area).hide())})})},flipImages:function(){var e=CubeBrowserListWidget.getSelectedItems().filter(".item-image"),t=e.length,r=this,i=$("#image-flip");if(0===t)return void CubeBrowserLogsWidget.add("Nebyl vybrán žádný obrázek","err");var a=Math.round(100/e.length);CubeBrowserProgressBarWidget.setProgress(0),e.each(function(){CubeBrowser.request("imageFlip",{item:$(this).data("realpath"),flip:$('select[name="flip"]',i).val(),createNew:$('input[name="create_new"]',i).is(":checked")?1:0},function(){CubeBrowserProgressBarWidget.addProgress(a),t--,0===t&&(CubeBrowserProgressBarWidget.setProgress(100),CubeBrowserListWidget.refreshPath(),$("div.file-operations-box",r.$area).hide())})})},watermarkImages:function(){var e=CubeBrowserListWidget.getSelectedItems().filter(".item-image"),t=e.length,r=this,i=$("#image-watermark");if(0===t)return void CubeBrowserLogsWidget.add("Nebyl vybrán žádný obrázek","err");if(/^[0-9a-f]{6}$/i.test($('input[name="color"]',i).val())===!1)return alert("Nesprávně zadaná barva textu"),!1;if(""!==$('input[name="colorBg"]',i).val()&&/^[0-9a-f]{6}$/i.test($('input[name="colorBg"]',i).val())===!1)return alert("Nesprávně zadaná barva pozadí"),!1;var a=Math.round(100/e.length);CubeBrowserProgressBarWidget.setProgress(0),e.each(function(){CubeBrowser.request("imageWatermark",{item:$(this).data("realpath"),text:$('input[name="text"]',i).val(),color:$('input[name="color"]',i).val(),colorBg:$('input[name="colorBg"]',i).val(),posX:$('select[name="posX"]',i).val(),posY:$('select[name="posY"]',i).val(),createNew:$('input[name="create_new"]',i).is(":checked")?1:0},function(){CubeBrowserProgressBarWidget.addProgress(a),t--,0===t&&(CubeBrowserProgressBarWidget.setProgress(100),CubeBrowserListWidget.refreshPath(),$("div.file-operations-box",r.$area).hide())})})}},CubeBrowserPreviewWidget={$area:null,realWidth:0,realHeight:0,init:function(){this.$area=$("#preview")},showPreview:function(e){var t=CubeBrowser.params.baseUrl+e.data("realpath")+"?time="+(new Date).getTime();this.$area.find("img").prop("src",t).show(),this.$area.find("span.icon").hide();var r=this;$("<img/>").attr("src",t).load(function(){r.realWidth=this.width,r.realHeight=this.height})},hidePreview:function(){this.$area.find("img").prop("src",null).hide(),this.$area.find("span.icon").show()}},rowCount=0,CubeBrowserProgressBarWidget={$area:null,$meter:null,text:null,progress:0,init:function(){this.$area=$("#progress-bar"),this.$meter=this.$area.find("span.progress"),this.$percents=this.$area.find("span.percent"),this.hideProgress()},addProgress:function(e){this.setProgress(this.progress+e)},setProgress:function(e){this.$area.show(),this.progress=e>=100?100:e,this.$meter.css("width",this.progress+"%"),this.$percents.text((null!==this.text?this.text+" ":null)+this.progress+"%"),100===this.progress&&setTimeout(function(){CubeBrowserProgressBarWidget.hideProgress()},2e3)},setAbort:function(e){var t=this;this.$area.find(".button-cancel").unbind("click").bind("click",function(){e.call(),t.hideProgress()}).show()},hideProgress:function(){this.$area.hide(),this.$meter.css("width","0%"),this.$percents.text("0%"),this.$area.find(".button-cancel").hide(),this.text=null},setText:function(e){this.text=e}};