function FileBrowserStatusBar(){rowCount++;var e="odd";if(rowCount%2===0){e="even"}this.setFileNameSize=function(e,t){};this.setProgress=function(e){};this.setAbort=function(e){}}var FileBrowserDialogue={listType:null,win:null,category:0,init:function(){FileBrowser.listType=tinyMCEPopup.getWindowArg("listType");FileBrowserDialogue.win=tinyMCEPopup.getWindowArg("window");FileBrowserDialogue.category=tinyMCEPopup.getWindowArg("cat");var e=tinyMCEPopup.getWindowArg("url");if(e!=""){var t=/data(\/.*\/)[a-z0-9._-]+/i;var n=e.match(t);if(n){FileBrowser.currentDir=n[1]}}FileBrowser.init()},submitFile:function(){FileBrowserDialogue.win.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=FileBrowser.getSelected().data("realpath");if(typeof FileBrowserDialogue.win.ImageDialog!="undefined"){if(FileBrowserDialogue.win.ImageDialog.getImageData)FileBrowserDialogue.win.ImageDialog.getImageData();if(FileBrowserDialogue.win.ImageDialog.showPreviewImage)FileBrowserDialogue.win.ImageDialog.showPreviewImage(FileBrowser.getSelected().data("realpath"))}tinyMCEPopup.close()}};var FileBrowser={cmsPluginUrl:null,currentDir:null,baseUrl:null,iconsDir:"images/files/",uploadLink:null,sessionId:null,listType:null,uploadFilesPosParams:null,$itemsBox:null,$dirCnt:null,writable:false,clipboard:{cut:false,items:new Array},extendJQ:function(){$.fn.selectItem=function(){$(this).addClass("item-selected")};$.fn.markItem=function(){$(this).addClass("item-marked")};$.fn.unselectItem=function(){$(this).removeClass("item-selected")};$.fn.unmarkItem=function(){$(this).removeClass("item-marked")};$.fn.clipCutItem=function(){$(this).addClass("item-cut")};$.fn.clipUncutItem=function(){$(this).removeClass("item-cut")};$.extend({isSelectedItem:function(e){return $(e).hasClass("item-selected")},isMarkedItem:function(e){return $(e).hasClass("item-marked")},getItemSize:function(e){var e=parseFloat(e);if(e>1048576){return Number(e/1048576).toFixed(2).toString()+" MB"}else if(e>1024){return Number(e/1024).toFixed(2).toString()+" KB"}else{return e.toString()+" B"}}})},init:function(){this.extendJQ();this.cmsPluginUrl=window.location.toString().replace("browser.php","jscripts/tinymce/");if(this.currentDir==null){if(openDir){this.currentDir=openDir}else{this.currentDir=this.loadPath()}}this.uploadFilesPosParams={sessionid:FileBrowser.sessionId,upload_send:"send",path:FileBrowser.currentDir,type:FileBrowser.listType};$(".swfupload-control").swfupload({upload_url:FileBrowser.uploadLink,file_post_name:"upload_file",post_params:FileBrowser.uploadFilesPosParams,file_size_limit:maxUploadFileSize/1024,file_types:FileBrowser.getFileTypes(),file_types_description:"files",file_upload_limit:150,file_queue_limit:0,button_image_url:FileBrowser.baseUrl+"/images/upload_cs.png",button_placeholder_id:"spanButtonPlaceholder",button_width:61,button_height:22,button_window_mode:SWFUpload.WINDOW_MODE.OPAQUE,flash_url:FileBrowser.baseUrl+"/jscripts/swfupload/swfupload.swf",flash9_url:FileBrowser.baseUrl+"/jscripts/swfupload/swfupload_fp9.swf"});$(".swfupload-control").bind("fileQueued",function(e,t){FileBrowser.uploadFilesPosParams.path=FileBrowser.currentDir;$(this).swfupload("setPostParams",FileBrowser.uploadFilesPosParams);$(this).swfupload("startUpload")}).bind("uploadComplete",function(e,t){$(this).swfupload("startUpload")}).bind("uploadStart",function(e,t){$("#uploading-files").show()}).bind("fileQueueError",function(e,t,n,r){FileBrowser.showResult([],["Velikost souboru "+t.name+" je větší než povolený limit"])}).bind("uploadSuccess",function(e,t,n){FileBrowser.load();$("#uploading-files").hide();var r=$.parseJSON(n);FileBrowser.showResult(r.infomsg,r.errmsg)});this.$itemsBox=$("#itemsList");$("#itemsList li a").live("keypress",function(e){if(e.keyCode==38||e.keyCode==40||e.keyCode==13||e.keyCode==46||e.keyCode==45){e.preventDefault();switch(e.keyCode){case 38:$(this).parent("li").prev().children("a").trigger("click",e.shiftKey);break;case 40:$(this).parent("li").next().children("a").trigger("click",e.shiftKey);break;case 13:$(this).trigger("dblclick",false);break;case 45:$(this).parent("li").next().children("a").trigger("click",true);break;case 46:$("#buttonDelete").click();break;default:alert(e.keyCode);break}}});$("#itemsList li a").live("click",function(e,t){e.preventDefault();$(this).focus();if(typeof t!="undefined")e.ctrlKey=t;if(typeof e.shiftKey=="undefined")e.shiftKey=false;if(e.ctrlKey){if($.isMarkedItem(this)){$(this).unmarkItem()}else{$(this).markItem()}}else if(e.shiftKey){var n=FileBrowser.getSelected();var r=$("li").index(n.parent("li"));var i=$("li").index($(this).parent("li"));var s=FileBrowser.getAllItems();if(r<=i){for(var o=r;o<=i;o++){$(s[o]).markItem()}}else{for(var u=r;u>=i;u--){$(s[u]).markItem()}}}else{FileBrowser.getMarked().unmarkItem();$(this).markItem()}FileBrowser.getSelected().unselectItem();$(this).selectItem();FileBrowser.showData($(this));return});$("#itemsList li a").live("dblclick",function(e,t){if($(this).data("type")=="dir"||$(this).data("type")=="dot"){FileBrowser.load($(this).data("path")+$(this).data("name")+"/")}else{FileBrowserDialogue.submitFile()}return});$(document).on("dragenter",function(e){e.stopPropagation();e.preventDefault()}).on("dragover",function(e){e.stopPropagation();e.preventDefault();_that.$itemsBox.addClass("draging")}).on("dragleave",function(e){_that.$itemsBox.removeClass("draging")}).on("drop",function(e){e.stopPropagation();e.preventDefault();_that.$itemsBox.removeClass("draging");var t=e.originalEvent.dataTransfer.files;_that.handleFileUpload(t)});this.load();FileBrowser.showTip()},showResult:function(e,t){if(t.length>0){$("#log").prepend("<br />").prepend($("<span></span>").text(t.join(", ")).addClass("errmsg"))}if(e.length>0){$("#log").prepend("<br />").prepend($("<span></span>").text(e.join(", ")).addClass("msg"))}},logMsg:function(e){},clearLog:function(){$("#log").html("")},showData:function(e){var t=150;var n=e.data();var r=$("#infoBox");var i=$("#fileActions").html("<p>Žádné nástroje nejsou k dispozici.</p>");r.html("");$("#currentFile").text(n.name);if(n.type=="dir"){if(n.access.write==true){var s=$("<p></p>");var o=$("<select></select>").attr({name:"users",size:6,multiple:true});var u=FileBrowser.getSelected();FileBrowser.request("getUsers",{path:u.data("path"),name:u.data("name")},function(e){var t=$("<option></option>");$.each(e.users,function(e){var n=t.clone();n.attr({value:this.id,selected:this.selected}).text(this.name);o.append(n)})});s.append("<strong>Povolení zápisu pro:</strong><br />");s.append(o);s.append("<br />");s.append('<input name="chenge_perms" value="Přiřadit" type="button" onClick="FileBrowser.setDirPerms()" />');i.html(s)}}else if(n.type=="file"){if(n.info.type=="image"){var a=$("<img />");var f=n.info.dimension.w;var l=n.info.dimension.h;if(n.info.dimension.w>t||n.info.dimension.h>t){if(n.info.dimension.w>n.info.dimension.h){l=n.info.dimension.h/n.info.dimension.w*t;f=t}else{f=n.info.dimension.w/n.info.dimension.h*t;l=t}}var c=new Date;a.attr("src",FileBrowser.baseUrl+n.realpath+"?t="+(c.getTime()/1e3).toString()).css({width:f,height:l-5});r.append($("<p></p>").addClass("imgprev-box").html(a));var h=$("<p></p>").addClass("file-info").html("Rozměry:<br/>"+n.info.dimension.w+"x"+n.info.dimension.h+" px<br />"+"Velikost:<br/>"+$.getItemSize(n.info.size)+"<br />");if(n.info.dimension.w>imageBigSizeW){h.append("<br /><strong>Obázek je příliš velký pro vložení do stránky!!!. Doporučujeme zmenšit alespoň na "+imageBigSizeW+"x"+imageBigSizeH+" px.</strong><br />")}r.append(h);var s=$("<p></p>");s.append("<strong>Vytvořit zmenšeninu:</strong><br />");s.append('<input type="text" size="5" maxlength="5" name="img_w" value="0" />&times;'+'<input type="text" size="5" maxlength="5" name="img_h" value="0" /> px '+'<input type="button" name="img_resize" value="Vytvořit" onClick="FileBrowser.imageResize()" /><br />'+'<input type="checkbox" name="img_ratio" checked="checked" /> Zachovat poměr '+'<input type="checkbox" name="img_crop" /> Ořezat'+"<hr />");var p=$('input[name="img_w"]',s).val(n.info.dimension.w).data("origsize",n.info.dimension.w);var d=$('input[name="img_h"]',s).val(n.info.dimension.h).data("origsize",n.info.dimension.h);p.change(function(){if($('input[name="img_ratio"]',s).is(":checked")){$('input[name="img_h"]',s).val(Math.round(parseInt($(this).val())/parseInt($('input[name="img_w"]',s).data("origsize"))*parseInt($('input[name="img_h"]',s).data("origsize"))))}});d.change(function(){if($('input[name="img_ratio"]',s).is(":checked")){$('input[name="img_w"]',s).val(Math.round(parseInt($(this).val())/parseInt($('input[name="img_h"]',s).data("origsize"))*$('input[name="img_w"]',s).data("origsize")))}});s.append("<strong>Otočit doprava:</strong><br />");s.append('<select name="img_degree">'+'<option value="90">90°</option>'+'<option value="180">180°</option>'+'<option value="270">270°</option>'+"</select>&nbsp;"+'<input type="button" name="img_rotate" value="Otočit" onClick="FileBrowser.imageRotate()" />'+"<hr />");s.append("<strong>Vytvořit obrázky v systémové velikosti:</strong><br />");s.append("Velký:"+imageBigSizeW+"x"+imageBigSizeH+" Malý:"+imageSmallSizeW+"x"+imageSmallSizeH+'&nbsp;<input type="button" name="img_system_sizes" value="Vytvořit" onClick="FileBrowser.imageSystemResize()" /><br />'+'<input type="checkbox" name="img_createdirs" checked="checked" /> Zařadit do adresářů (small, medium) '+"<hr />");i.html(s)}else if(n.info.type=="flash"){r.html("");var f=n.info.dimension.w;var l=n.info.dimension.h;if(n.info.dimension.w>t||n.info.dimension.h>t){if(n.info.dimension.w>n.info.dimension.h){l=n.info.dimension.h/n.info.dimension.w*t;f=t}else{f=n.info.dimension.w/n.info.dimension.h*t;l=t}}var v=$("<p></p>").addClass("imgprev-box");v.html('<object width="'+f+'" height="'+l+'">'+'<param name="movie" value="'+FileBrowser.baseUrl+n.realpath+'">'+'<embed src="'+FileBrowser.baseUrl+n.realpath+'" width="'+f+'" height="'+l+'">'+"</embed></object>");r.append(v);r.append($("<p></p>").addClass("file-info").html("Rozměry:<br/>"+n.info.dimension.w+"x"+n.info.dimension.h+" px<br />"+"Velikost:<br/>"+$.getItemSize(n.info.size)+"<br />"))}else{r.html($("<p></p>").addClass("file-info").html("Velikost:<br/>"+$.getItemSize(n.info.size)+"<br />"))}}},timer:null,showWorking:function(){FileBrowser.timer=setTimeout(function(){$("#working").show()},500)},hideWorking:function(){clearTimeout(FileBrowser.timer);$("#working").hide()},getFileTypes:function(){var e=Array();if(this.listType=="image"){e=Array("jpg","jpeg","png","gif","bmp","wmf")}else if(this.listType=="media"){e=Array("swf","mp4","m4v","ogv","mov","flv","rm","qt","avi","mp3","ogg","wma","wav")}if(e.length!=0){var t=e.length;for(var n=0;n<t;n++){e[n]="*."+e[n];e[n+t]=e[n].toUpperCase()}return e.join(";")}return"*.*"},request:function(e,t,n,r){$.ajax({type:"POST",data:t,url:window.location.toString().replace("browser.php",e+".php"),cache:false,success:function(e){if(typeof n=="function"){n.call(this,e)}if(e.infomsg.length>0||e.errmsg.length>0){FileBrowser.showResult(e.infomsg,e.errmsg)}},error:function(){FileBrowser.showResult([],["Chyba při komunikaci se serverem. Zkuste znovu."])},complete:function(){}})},getSelected:function(){return this.$itemsBox.find("li a.item-selected")},getMarked:function(){return this.$itemsBox.find("li a.item-marked")},getAllItems:function(){return this.$itemsBox.find("li a")},handleFileUpload:function(e){for(var t=0;t<e.length;t++){var n=new FormData;n.append("upload_file",e[t]);$.each(FileBrowser.uploadFilesPosParams,function(e,t){n.append(e,t)});var r=new FileBrowserStatusBar;r.setFileNameSize(e[t].name,e[t].size);this.sendFileToServer(n,r)}},sendFileToServer:function(e,t){var n=this;var r=$.ajax({xhr:function(){var e=$.ajaxSettings.xhr();if(e.upload){e.upload.addEventListener("progress",function(e){var n=0;var r=e.loaded||e.position;var i=e.total;if(e.lengthComputable){n=Math.ceil(r/i*100)}t.setProgress(n)},false)}return e},url:FileBrowser.uploadLink,type:"POST",contentType:false,processData:false,cache:false,data:e,success:function(e){t.setProgress(100);FileBrowser.showResult(e.infomsg,e.errmsg);n.load()}});t.setAbort(r)},load:function(e){if(typeof e=="undefined")e=this.currentDir;FileBrowser.showWorking();this.request("getitems",{path:e,type:FileBrowser.listType},function(e){FileBrowser.hideWorking();var t=FileBrowser.getSelected().data("realpath");FileBrowser.$itemsBox.html("");if(typeof e.items!="undefined"){$.each(e.items,function(){var e=$("<a>");e.append(this.name).attr({title:this.name,href:this.realpath}).data(this);if(this.type=="dir"){e.addClass("dir");if(this.info.type=="home"){e.addClass("dir-home")}else if(this.info.type=="public"){e.addClass("dir-pub")}if(this.access.write==true)e.addClass("dir-writable")}else if(this.type=="dot"){e.addClass("dir");e.addClass("dir-up")}else{e.addClass("file").css("background-image","url("+FileBrowser.baseUrl+FileBrowser.iconsDir+this.info.type+"_icon.png)");if(this.access.write==true)e.addClass("file-writable")}FileBrowser.$itemsBox.append($("<li></li>").append(e))});FileBrowser.writable=e.writable;if(FileBrowser.currentDir==e.current&&typeof t!="undefined"){var n=FileBrowser.$itemsBox.find('a[href="'+t+'"]');if(n.length>0){n.click()}else{FileBrowser.$itemsBox.children("li:first a").click()}}else{FileBrowser.$itemsBox.children("li:first a").click();FileBrowser.storePath(e.current)}FileBrowser.currentDir=e.current;$("#currentPath").text(e.current)}else{FileBrowser.goPublic()}})},goHome:function(){this.currentDir="home";this.load()},goPublic:function(){this.currentDir="/public/";this.load()},storePath:function(e){var t=cookieName+"="+escape(e)+";";var n=new Date;n.setTime(n.getTime()+30*60*1e3);t+="expires="+n.toGMTString()+";";t+="path=/;";document.cookie=t},loadPath:function(){if(document.cookie.length>0&&FileBrowser.currentDir==null){var e=document.cookie.indexOf(cookieName+"=");if(e!=-1){e=e+cookieName.length+1;var t=document.cookie.indexOf(";",e);if(t==-1)t=document.cookie.length;return unescape(document.cookie.substring(e,t))}}return baseLoadPath},createDir:function(){if(this.writable==false){alert("Nemáte dostatečná práva pro vytvoření adresáře");return false}var e=prompt("Zadejte název nového adresáře");if(e==null||e=="")return false;FileBrowser.request("createdir",{path:this.currentDir,newname:e},function(){FileBrowser.load()});return true},deleteItems:function(){if(confirm("Opravdu smazat označené položky?")==false)return;this.showWorking();var e=new Array;this.getMarked().each(function(){e.push(new Array($(this).data("path"),$(this).data("name")))});if(e.length>0){this.request("delete",{items:e},function(){FileBrowser.hideWorking();FileBrowser.load()})}return},renameItems:function(){var e=new Array;var t="";this.getMarked().each(function(){var n=$(this).data();if(n.type!="dot"&&n.access.write==true){t=window.prompt("Přejmenovat na",n.name);if(t!=null&&t!=""&&t!=n.name){e.push(new Array(n.path,n.name,t))}}});if(e.length>0){FileBrowser.showWorking();this.request("rename",{items:e},function(){FileBrowser.hideWorking();FileBrowser.load()})}},clipboardCut:function(){this.clipboardClear();FileBrowser.clipboard.cut=true;this.getMarked().each(function(){if($(this).data("type")!="dot"){$(this).addClass("item-cut");FileBrowser.clipboard.items.push($(this).data())}});this.clipboardShow();return},clipboardCopy:function(){this.clipboardClear();FileBrowser.clipboard.cut=false;this.getMarked().each(function(){if($(this).data("type")!="dot"){$(this).addClass("item-copy");FileBrowser.clipboard.items.push($(this).data())}});this.clipboardShow();return},clipboardPaste:function(){this.showWorking();var e=new Array;$.each(this.clipboard.items,function(){var t=this;e.push(new Array(t.path,t.name))});this.request("copy",{target:this.currentDir,items:e,move:this.clipboard.cut},function(){FileBrowser.clipboardClear();FileBrowser.hideWorking();FileBrowser.load()})},clipboardClear:function(){this.clipboard.cut=false;this.clipboard.items=new Array;FileBrowser.getMarked().removeClass("item-cut").removeClass("item-copy");$("#clipboard").html("")},clipboardShow:function(){var e=$("#clipboard");$.each(FileBrowser.clipboard.items,function(){e.append("<li><span>"+this.realpath+"</span></li>")})},imageResize:function(){FileBrowser.showWorking();var e=Array;if($('input[name="apply_all"]').is(":checked")){e=FileBrowser.getMarked()}else{e=FileBrowser.getSelected()}var t=new Array;e.each(function(){t.push($(this).data("name"))});FileBrowser.request("imageResized",{path:FileBrowser.currentDir,file:t,ratio:$('input[name="img_ratio"]').is(":checked"),newW:$('input[name="img_w"]').val(),newH:$('input[name="img_h"]').val(),crop:$('input[name="img_crop"]').is(":checked")},function(){FileBrowser.hideWorking();FileBrowser.load()})},imageSystemResize:function(){FileBrowser.showWorking();var e=Array;if($('input[name="apply_all"]').is(":checked")){e=FileBrowser.getMarked()}else{e=FileBrowser.getSelected()}var t=new Array;e.each(function(){t.push($(this).data("name"))});FileBrowser.request("createSystemImages",{path:FileBrowser.currentDir,file:t,createdirs:$('input[name="img_createdirs"]').is(":checked")},function(){FileBrowser.hideWorking();FileBrowser.load()})},imageRotate:function(){FileBrowser.showWorking();var e=Array;if($('input[name="apply_all"]').is(":checked")){e=FileBrowser.getMarked()}else{e=FileBrowser.getSelected()}var t=new Array;e.each(function(){t.push($(this).data("name"))});FileBrowser.request("imageRotate",{path:FileBrowser.currentDir,file:t,degree:$('select[name="img_degree"]').val()},function(){FileBrowser.hideWorking();FileBrowser.load()})},setDirPerms:function(){var e=$('select[name="users"]').val();FileBrowser.getMarked().each(function(){if($(this).data("type")=="dir"){FileBrowser.request("storeDirPerms",{path:$(this).data("path"),name:$(this).data("name"),users:e})}})},showTip:function(){$("#log").html($("<span></span>").addClass("tip").text("TIP: "+tips[Math.floor(Math.random()*tips.length)]))}};var rowCount=0;