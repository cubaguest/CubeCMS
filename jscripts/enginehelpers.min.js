
var CubeCMS=CubeCMS||{};CubeCMS={contentSelector:".main-content",lang:null,primaryLang:null,domain:null,toolboxTopOffset:30,baseOpt:{},init:function(a){$.extend(this,a);document.domain=this.domain;document.lang=this.lang;document.primaryLang=this.primaryLang;CubeCMS.ToolBox.toolboxTop=this.toolboxTopOffset},setup:function(){this.Msg.init();this.Loader.init();this.ToolBox.init();this.Form.init();this.Modal.init();this.Popup.init()}};CubeCMS.Msg={infoBox:null,errBox:null,init:function(){this.infoBox=$("#infoMessages");this.errBox=$("#errMessages")},info:function(b,a){if(b==null){return this}if(typeof(a)=="undefined"){a=true}if(a==true){this.clear("info")}this.infoBox.prepend("<p>"+b+"</p>").slideDown();$("body").scrollTop(this.infoBox.offset().top-50);return this},err:function(b,a){if(b==null){return this}if(typeof(a)=="undefined"){a=true}if(a==true){this.clear("err")}this.errBox.prepend("<p>"+b+"</p>").slideDown();$("body").scrollTop(this.errBox.offset().top-50);return this},show:function(a){this.clear("info");this.clear("error");if(typeof(a.infomsg)=="object"){for(var b=0;b<a.infomsg.length;b++){this.info(a.infomsg[b],false)}}else{if(typeof(a.infomsg)=="string"){this.info(a.infomsg)}}if(typeof(a.errmsg)=="object"){for(var c=0;c<a.errmsg.length;c++){this.err(a.errmsg[c],false)}}else{if(typeof(a.infomsg)=="string"){this.err(a.errmsg)}}},clear:function(a){if(a=="info"){this.infoBox.html(null).hide()}else{if(a=="err"||a=="error"){this.errBox.html(null).hide()}}return this}};CubeCMS.Tools={str2url:function(b,a){b=b.toUpperCase();b=b.toLowerCase();b=b.replace(/[\u0105\u0104\u00E0\u00E1\u00E2\u00E3\u00E4\u00E5]/g,"a");b=b.replace(/[\u00E7\u010D\u0107\u0106]/g,"c");b=b.replace(/[\u010F]/g,"d");b=b.replace(/[\u00E8\u00E9\u00EA\u00EB\u011B\u0119\u0118]/g,"e");b=b.replace(/[\u00EC\u00ED\u00EE\u00EF]/g,"i");b=b.replace(/[\u0142\u0141]/g,"l");b=b.replace(/[\u00F1\u0148]/g,"n");b=b.replace(/[\u00F2\u00F3\u00F4\u00F5\u00F6\u00F8\u00D3]/g,"o");b=b.replace(/[\u0159]/g,"r");b=b.replace(/[\u015B\u015A\u0161]/g,"s");b=b.replace(/[\u00DF]/g,"ss");b=b.replace(/[\u0165]/g,"t");b=b.replace(/[\u00F9\u00FA\u00FB\u00FC\u016F]/g,"u");b=b.replace(/[\u00FD\u00FF]/g,"y");b=b.replace(/[\u017C\u017A\u017B\u0179\u017E]/g,"z");b=b.replace(/[\u00E6]/g,"ae");b=b.replace(/[\u0153]/g,"oe");b=b.replace(/[\u013E\u013A]/g,"l");b=b.replace(/[\u0155]/g,"r");b=b.replace(/[^a-z0-9\s\'\:\/\[\]-]/g,"");b=b.replace(/[\s\'\:\/\[\]-]+/g," ");b=b.replace(/[ ]/g,"-");b=b.replace(/[\/]/g,"-");if(a==1){var d=b.charAt(0);b=d.toUpperCase()+b.slice(1)}return b},stripHtml:function(b){var a=document.createElement("DIV");a.innerHTML=b;return a.textContent||a.innerText},checkUrlKey:function(a,c,d){var b=$(element);$.ajax({type:"POST",url:a,cache:false,data:{key:b.val(),lang:b.attr("lang")},success:function(e){if(typeof e.urlkey!="undefined"&&$.isFunction(d)){d(e.urlkey)}}})},contrastColor:function(c){var b=1-(0.299*parseInt((c).substring(0,2),16)+0.587*parseInt((c).substring(2,4),16)+0.114*parseInt((c).substring(4,6),16))/255;if(b<0.5){return"#000000"}else{return"#ffffff"}},loadPageLang:function(a,b){showLoadBox(CubeCMS.contentSelector);$(CubeCMS.contentSelector).load(a,function(c){var d=a.match(/(l=[a-z]{2})/g);if(d!==null){$(CubeCMS.contentSelector).html(c.replace(d[0],""))}hideLoadBox();$(document).scroll()})},uniqID:{counter:0,get:function(a){if(!a){a="uniqid"}var b=a+"-"+CubeCMS.Tools.uniqID.counter++;if($("#"+b).length===0){return b}else{return CubeCMS.Tools.get(a)}}},formatFileSize:function(c){var b=-1;var a=[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"];do{c=c/1024;b++}while(c>1024);return Math.max(c,0.1).toFixed(1)+a[b]},getScrollBarWidth:function(){var b=document.createElement("div");b.className="scrollbar-measure";document.body.appendChild(b);var a=b.offsetWidth-b.clientWidth;document.body.removeChild(b);return a},rememberTabSelection:function(a,c){var d="selectedTabFor"+a;if(b(d)){$(a).find('a[href="'+b(d)+'"]').tab("show")}$(a).on("click","a[data-toggle]",function(f){e(d,this.getAttribute("href"))});function b(f){return c?location.hash:localStorage.getItem(f)}function e(f,g){if(c){location.hash=g}else{localStorage.setItem(f,g)}}},callFunction:function(f,c){var a=Array.prototype.slice.call(arguments,2);var e=f.split(".");var d=e.pop();for(var b=0;b<e.length;b++){c=c[e[b]]}return c[d].apply(c,a)},functionExist:function(f,c){if(typeof c===undefined){c=window}var a=Array.prototype.slice.call(arguments,2);var e=f.split(".");var d=e.pop();for(var b=0;b<e.length;b++){c=c[e[b]]}if(typeof c==="undefined"){return false}if(typeof c[d]==="function"){return true}return false},containsObject:function(c,b){var a;for(a=0;a<b.length;a++){if(b[a]===c){return true}}return false},setCookie:function(c,d,e){var a="";if(e){var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));a="; expires="+b.toUTCString()}document.cookie=c+"="+d+a+"; path=/"},getCookie:function(b){var e=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var f=a[d];while(f.charAt(0)==" "){f=f.substring(1,f.length)}if(f.indexOf(e)==0){return f.substring(e.length,f.length)}}return null},clearCookie:function(a){CubeCMS.Tools.setCookie(a,"",-1)}};CubeCMS.ToolBox={enablePageTracking:true,toolboxTop:30,boxesPositions:new Array(),init:function(){var a=this;$(document).ajaxComplete(function(c,d,b){a.initHtml();a.initEvents();a.initLangLoader();a.initFixedBoxs()});this.initHtml()},containPosition:function(c,b){var a;for(a=0;a<b.length;a++){if(b[a].top===c.top&&b[a].left===c.left){return true}}return false},initHtml:function(){$("div.toolbox").parent("div").css({position:"relative"});$(".toolbox").each(function(){if($(this).data("_ccms_loaded")){return}$(this).data("_ccms_loaded",true);var b=CubeCMS.Tools.uniqID.get("toolbox");$(this).prop("id",b);$(".toolbox-button",this).prop("id",b+"-button");$(this).children(".toolbox-tools").prop("id",b+"-tools");var a={top:$(this).offset().top,left:$(this).offset().left};if(CubeCMS.ToolBox.containPosition(a,CubeCMS.ToolBox.boxesPositions)){$(this).data("offset-right-multiplier",1)}else{$(this).data("offset-right-multiplier",0);CubeCMS.ToolBox.boxesPositions.push({top:$(this).offset().top,left:$(this).offset().left})}console.log(a);$(this).css("right",3+CubeCMS.ToolBox.getToolboxOffset($(this)))});$(".toolbox>.toolbox-tools").appendTo("body");this.initEvents();this.initLangLoader();this.initFixedBoxs()},initEvents:function(){var a=this;$("body").on("mouseenter","div.toolbox",function(c){var d="#"+$(this).prop("id");$(d).parent().addClass("toolbox-active-content");var b=$(d+"-tools");b.css({top:$(this).offset().top-2,left:$(this).offset().left-b.outerWidth()+$(d+"-button").outerWidth()+2,right:"auto"}).fadeIn(100);$("body").on("touchstart",function(){b.trigger("mouseleave")})});$("body").on("mouseleave","div.toolbox-tools",function(b){if($(this).parent(".toolbox-tool").length===0){if((typeof b.fromElement!=="undefined"&&!b.fromElement.length)||(typeof b.fromElement==="undefined"&&b.target.tagName!=="SELECT")){$(this).fadeOut(100)}}$("#"+$(this).prop("id").toString().replace("-tools","")).parent().removeClass("toolbox-active-content")});$("body").on("touchstart",".toolbox-button",function(b){$(this).parent().trigger("mouseenter");return false});$("body").on("touchstart",".toolbox-tools *",function(b){b.stopPropagation()});$(document).on("scroll",function(){var c=$(this).scrollTop();var b=$(".toolbox");b.each(function(){var d=$(this).parent();if(d.is(":visible")&&d.offset().top<(c+a.toolboxTop)&&c<(d.offset().top+d.height()-a.toolboxTop-$(".toolbox-button",this).outerHeight())){$(this).css({position:"fixed",top:a.toolboxTop,left:$(this).offset().left,right:"auto"})}else{$(this).css({position:"absolute",top:3,right:3+CubeCMS.ToolBox.getToolboxOffset($(this)),left:"auto"})}})})},getToolboxOffset:function(a){var b=0;if(a.data("offset-right-multiplier")>0){b=a.data("offset-right-multiplier")*a.outerWidth()+5}return b},initLangLoader:function(){$("body").on("click","a.toolbox-changelang-button",function(b){b.preventDefault();CubeCMS.Loader.showLoadBox(".main-content");var a=this.href;$(".main-content").load(a,function(c){var d=a.match(/(l=[a-z]{2})/g);if(d!=null){$(".main-content").html(c.replace(d[0],""))}CubeCMS.Loader.hideLoadBox();$(document).scroll()});return false})},initFixedBoxs:function(){$(".fixed-actions-box").each(function(){var a=$(this);if(!a.data("container")){return}var c=$(a.data("container"));var b=a.offset().top;var d=a.offset().top+c.outerHeight();$(window).on("scroll",function(){if($(window).scrollTop()+30>b&&$(window).scrollTop()<d){if(!a.hasClass("fixed-actions-box-helper")){a.after($('<div class="fixed-actions-box-palceholder hidden"></div>').height(a.height()).width(a.width()));a.outerWidth(a.outerWidth()).addClass("fixed-actions-box-helper").css({left:a.offset().left})}}else{a.removeClass("fixed-actions-box-helper").css({left:"auto",width:"auto"});a.next(".fixed-actions-box-palceholder").remove()}})})}};CubeCMS.ToolBox.Tool={init:function(){}};CubeCMS.Images={slideShowFade:function(a,b){$(a+" .image:gt(0)").hide();setInterval(function(){$(a+" .image:first").fadeOut().next(".image").fadeIn().end().appendTo(a)},b)},loadImage:function(b,c){var a=document.createElement("img");a.onload=function(){if($.isFunction(c)){c.call(a)}};a.src=b}};CubeCMS.Loader={timeout:10000,loaderCnt:'<div id="loadingBox" class="loadingBox"><div class="loader-w"><span class="loader-text">{MSG}</span></div>',loadBoxClass:"loadingBox",init:function(){},loadUrl:function(b,a){},showLoadBox:function(d,f){if(typeof(f)=="undefined"){f="loading..."}var e="loadingBox-"+(Math.floor(Math.random(0)*10000));var c=$(d).parent("div,p");var a=$(this.loaderCnt.replace("{MSG}",f)).addClass(this.loadBoxClass).attr("id",e).css({position:"absolute",top:0,left:0,opacity:0,width:c.width()+parseInt(c.css("padding-left"))+parseInt(c.css("padding-right"))+parseInt(c.css("margin-left"))+parseInt(c.css("margin-right")),height:c.height()+parseInt(c.css("padding-top"))+parseInt(c.css("padding-bottom"))+parseInt(c.css("margin-top"))+parseInt(c.css("margin-bottom"))});if(c.css("position")!="absolute"&&c.css("position")!="relative"){c.css("position","relative")}c.prepend(a.hide());a.fadeTo(500,1);var b=this;setTimeout(function(){b.hideLoadBox(e)},this.timeout);return e},hideLoadBox:function(a){if(typeof(a)=="undefined"){$("."+this.loadBoxClass).remove()}else{if(a instanceof jQuery){a.parent("div,p").find("."+this.loadBoxClass).remove()}else{$("#"+a).remove()}}}};CubeCMS.Form={init:function(){this.initLangSelector();this.initUrlCheckers();this.initAdvancedFormElements();this.initAjaxForms()},addRow:function(b){var a=$(b).closest(".form-input-multiple");var c=a.clone(true);var d=c.find("input");d.attr("id",d.attr("id")+Math.floor((Math.random()*10)+1)).attr("name",d.attr("name").replace(/\[.*\]/,"[]")).val("");a.removeClass("form-input-multiple-last").find("a.button-add-multiple-line").hide();a.after(c.hide());c.show().css("display","table");if(a.closest(".form-controls").find(".form-input-multiple").length>1){a.closest(".form-controls").find("a.button-remove-multiple-line").show()}return false},removeRow:function(b){var a=$(b).closest(".form-input-multiple");var c=a.closest(".form-controls");a.fadeOut(100,function(){if(a.hasClass("form-input-multiple-last")){a.prev().addClass("form-input-multiple-last").find("a.button-add-multiple-line").show();a.prev().addClass("form-input-multiple-last")}$(this).remove();if(c.find(".form-input-multiple").length==1){c.find("a.button-remove-multiple-line").hide()}});return false},addButton:function(a,b){b=$.extend({icon:"refresh",href:window.location+"#",text:null,elementClass:null,id:null},b);if(!a.parent().hasClass("input-group")){a.wrap($("<div></div>").addClass("input-group"))}var c=$("<a></a>").addClass("input-group-btn").addClass(b.elementClass).prop({href:b.href,id:b.id});if(b.icon!==null){c.append($("<span></span>").addClass("icon").addClass("icon-"+b.icon))}if(b.text!==null){c.html(b.text)}a.parent().append(c)},initLangSelector:function(){$("body").on("click","form .lang-container a.link-lang",function(b,a){if(typeof a==="undefined"){a=true}var e=this.lang;$(this).parent().find("a").removeClass("link-lang-sel");$(this).addClass("link-lang-sel");var d=$(this).closest("*:has(div[lang])");$("div[lang]",d).hide();var c=$('div[lang="'+e+'"]',d).show();if(a){c.find("input,textarea,select").focus()}d=$(this).closest("*:has(label[lang])")[0];$("label[lang]",d).hide();$('label[lang="'+e+'"]',d).show();return false});$("body").on("click","form .lang-container a.link-lang-duplicator",function(b){b.preventDefault();var a=$(this).parent().find(".link-lang-sel").prop("lang");var d=$(this).closest("*:has(div[lang])");if(d.find('div[lang="'+a+'"] textarea').length>0){if(d.find('div[lang="'+a+'"] textarea + span.mceEditor')){var c=tinyMCE.get(d.find('div[lang="'+a+'"] textarea').prop("id")).getContent();d.find("textarea").each(function(){tinyMCE.get($(this).prop("id")).setContent(c)})}else{d.find("div[lang] textarea").val(d.find('div[lang="'+a+'"] textarea').val())}}else{d.find("div[lang] input,select").val(d.find('div[lang="'+a+'"] input,select').val())}});if(typeof CubeCMS.primaryLang!=="undefined"){$('.lang-container a[lang="'+CubeCMS.primaryLang+'"]').trigger("click",[false])}else{$('.lang-container a[lang="'+CubeCMS.lang+'"]').trigger("click",[false])}},initUrlCheckers:function(){var a=this;$(".input-urlkey-autoupdate").on("change",function(){a.checkUrlKey($(this),$(this).data("checkurl"))});$(".button_update_urlkey").on("click",function(c){c.preventDefault();var b=$($(this).data("element"));a.checkUrlKey(b,b.data("checkurl"));return false})},checkUrlKey:function(a,b,c){var d={key:a.val(),lang:a.attr("lang")};$.extend(d,a.data());if(typeof c!=="undefined"){$.extend(d,c)}a.trigger("beforeCheck",[d,b]);$.ajax({type:"POST",url:b,data:d,cache:false,success:function(e){if(typeof e.urlkey!=="undefined"){a.val(e.urlkey)}a.trigger("checkComplete")}})},initAdvancedFormElements:function(){$("form").each(function(){var a=$(".form-group-advanced",this).hide();var c=$(this);if(a.length>0){$(this).addClass("form-advanced");var b=$("<button></button>").prop("type","button").html('<span class="icon icon-eye"></span> pokročilé možnosti').data("expanded",false).on("click",function(){if($(this).data("expanded")){$(".icon",this).removeClass("icon-eye-slash").addClass("icon-eye");$(this).data("expanded",false);$(".form-group-advanced,.form-fieldset-advanced",c).slideUp(300)}else{$(".icon",this).removeClass("icon-eye").addClass("icon-eye-slash");$(this).data("expanded",true);$(".form-fieldset-advanced .form-group-advanced",c).show();$(".form-group-advanced,.form-fieldset-advanced",c).slideDown(300)}});$(this).prepend($('<div class="form-advance-buttons"></div>').append(b))}$("form fieldset").each(function(){if($(this).find("div.form-group:visible").length===0&&$(this).find("table.form-table").length===0&&!$(this).hasClass("not-hidden")){$(this).addClass("form-fieldset-advanced").hide()}})})},setMessages:function(b,a){b.find(".form-errors,.form-success").html(null);if(a.errmsg.length>0){var c=b.find(".form-errors");c.html(null);$.each(a.errmsg,function(d,e){if(typeof e==="string"){c.append("<div>"+e+"</div>")}});c.slideDown(400)}if(b.find(".form-errors div").length===0){b.find(".form-errors").hide()}if(a.infomsg.length>0){var c=b.find(".form-success");c.html(null);$.each(a.infomsg,function(d,e){c.append("<div>"+e+"</div>")});c.slideDown(400)}else{b.find(".form-success").hide()}if(a.infomsg.length==0&&a.errmsg.length==0){this.hideMessages(b)}},hideMessages:function(a){a.find(".form-success,.form-errors").slideUp(400)},initAjaxForms:function(){$("form.cubecms-ajax-form").each(function(){$(this).on("submit",function(c){c.preventDefault();var b=$(this);CubeCMS.Form.hideMessages(b);var a={method:"POST",url:b.prop("action"),data:b.serialize()+"&_cubecms_respond_class=",success:function(d){if(typeof d==="object"){var e=b.data("callback");if(typeof e!=="undefined"&&CubeCMS.Tools.functionExist(e)){CubeCMS.Tools.callFunction(b.data("callback"),window,b,d)}else{CubeCMS.Form.ajaxFormSuccess(b,d)}}else{console.log("ERR: neimplmentovaná chyba aplikace")}}};$.ajax(a);return false})})},ajaxFormSuccess:function(b,a){if(typeof a.redirect!=="undefined"){window.location.replace(a.redirect)}CubeCMS.Form.setMessages(b,a)}};CubeCMS.Modal={init:function(){$("body").on("click",".cubecms-modal .close-modal",function(){CubeCMS.Modal.close($(this).closest(".cubecms-modal"));return false}).on("click",".modal-open-button",function(){CubeCMS.Modal.open($($(this).data("modal")));return false});$(".cubecms-modal").each(function(){})},open:function(a){a=$(a);if(a.length>0){$("body").addClass("cubecms-modal-open").css({paddingRight:CubeCMS.Tools.getScrollBarWidth()});a.fadeIn(200)}},close:function(a){a=$(a);if(a.length>0){a.fadeOut(200,function(){$("body").removeClass("cubecms-modal-open").css({paddingRight:0})})}}};CubeCMS.Popup={init:function(){var a=this;$(".cubecms-link-popup").each(function(){$(this).on("click",function(c){if($(this).prop("href")===undefined||$(this).prop("href")===""){return}c.preventDefault();var b=$(this).prop("href");b=(b.indexOf("?")===-1?b+"?popupwindow=1":b+"&popupwindow=1");b=b+($(this).data("popup-callback")===undefined?"":"&callback="+$(this).data("popup-callback"));a.openPopup(b,$(this).prop("title"),$(this).data("popup-width"),$(this).data("popup-height"));return false})});$("body.popup .button-cancel").click(function(){window.close()})},openPopup:function(a,i,j,d){var f=window.screenLeft!==undefined?window.screenLeft:screen.left;var b=window.screenTop!==undefined?window.screenTop:screen.top;width=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width;height=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;var c=((width/2)-(j/2))+f;var g=((height/2)-(d/2))+b;var e=window.open(a,i,"scrollbars=yes, width="+j+", height="+d+", top="+g+", left="+c);if(window.focus){e.focus()}}};function vveShowMessages(a){CubeCMS.Msg.show(a)}function infoMsg(b,a){CubeCMS.Msg.info(b,a)}function clearInfoMsg(){CubeCMS.Msg.clear("info")}function clearErrMsg(){CubeCMS.Msg.clear("error")}function errMsg(b,a){CubeCMS.Msg.err(b,a)}function showLoadBox(a,b){CubeCMS.Loader.showLoadBox(a)}function hideLoadBox(){CubeCMS.Loader.hideLoadBox()}function vveLoadImage(a,b){CubeCMS.Images.loadImage(a,b)}function str2url(c,b,a){return CubeCMS.Tools.str2url(c,a)}function vveCheckUrlKey(a,c,f,d){var b=$(c);var e={key:b.val(),lang:b.attr("lang")};if(typeof d!="undefined"){$.extend(e,d)}$.ajax({type:"POST",url:a,data:e,cache:false,success:function(g){if((f||f!="")&&(typeof f!=="undefined")){if(typeof g.urlkey!=="undefined"){f(g.urlkey)}else{f(null)}}}})}$(document).ready(function(){CubeCMS.setup();$("body").on("click",".link-external",function(){window.open(this.href);return false})});